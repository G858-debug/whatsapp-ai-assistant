# App Plan

The application code will be organized into three main folders: trainer, trainee, and common. Within each folder, features will have their own separate folders - for example, a register folder that contains all registration-related code. The code will be split into multiple files for easy maintenance, rather than having all the code in a single file.

When the app's WhatsApp account receives a message from a visitor, the system will first check if the sender's number exists in the user table. If the number is found, the system will check what role the user is logged in as - trainer, trainee, or if the login status is empty.

If the user is logged in as a trainer and if the user exists in the trainer table, the system will check if the message is a task invoking handler and whether that task can be performed by a trainer. If it is a handler, the system will run the task and save it as running in the trainer task list. If the message is not a task invoking message, the system will check if the number has any last running trainer task. If there is a last running trainer task and the task is not stopped, the system will continue with the next step of that task. If there is no running trainer task or if the last task is stopped, the system will retrieve the last five completed trainer tasks and the last ten chat history entries and provide this information to our AI assistant (Claude), which has all the app task information in its prompt. The AI can then determine if the user is asking to perform any trainer allowable task. If yes, the AI will provide the user with relevant buttons to click with handlers (like /view-profile) which can trigger a task and save the task as running in the trainer task list. If the user is not asking to perform any task, the AI can provide a relevant message with next task suggestions based on the last tasks data and last chat history data.

If the user is logged in as a trainee and if the user exists in the trainee table, the system will check if the message is a task invoking handler and whether the task can be performed by a trainee. If it is a handler, the system will run the task and save it as running in the trainee task list. If the message is not a task invoking message, the system will check if the number has any last running trainee task. If there is a last running trainee task and the task is not stopped, the system will continue with the next step of that task. If there is no running trainee task or if the last task is stopped, the system will retrieve the last five completed trainee tasks and the last ten chat history entries and provide this information to our AI assistant (Claude), which has all the app task information in its prompt. The AI can then determine if the user is asking to perform any trainee allowable task. If yes, the AI will provide the user with relevant buttons to click with handlers (like /view-profile) which can trigger a task and save the task as running in the trainee task list. If the user is not asking to perform any task, the AI can provide a relevant message with next task suggestions based on the last tasks data and last chat history data.

If the user is found but the login status is empty, then if the user is found in the trainer table but not found in the trainee table, the system will mark the user login as trainer and say you logged in as trainer now, you can ask me for any trainer related task to perform and can also ask to logout (making login as status empty) and then can register as trainee. If the user is found in the trainee table but not found in the trainer table, the system will mark the user login as trainee and say you logged in as trainee now, you can ask me for any trainee related task to perform and can also ask to logout (making login as status empty) and then can register as trainer. If the user is found in both trainer table and trainee table, then the AI will ask how you want to login and give buttons - as trainer or as trainee. This will create a task like choosing login as and the AI will see the role answer and if the role answer is trainer or trainee then mark the user login as whichever role is chosen from trainer and trainee and then say you logged in as [the chosen role] now, you can ask me for any [chosen role] related task to perform and can also ask to logout (making login as status empty) and ask to switch role. And if the user asks to switch, the AI can give handler button to switch to the opposite role and the handler will update the user login as accordingly.

If the user is not found, then the AI will ask how you want to register and will give button handler for register as trainer or trainee and on button click, the onboarding task will start for the visitor number and from trainer_registration_inputs.json or client_registration_inputs.json (based on the handler) the app will get the necessary information one by one and after the last input save the data as trainer or trainee and create user entry with trainer or trainee id and mark logged in as trainer or trainee.

The user can directly send messages like /logout, /switch-role (if opposite role exists), /register (if login as empty - meaning if logged out) to perform those tasks directly.

The user can ask the AI to show the profile info and the AI can give the user the relevant handler button and the handler will show the role table (trainer or trainee) related info and user table showable info and the user can directly run the /view-profile handler too.

The user can ask the AI to edit the profile, where the AI can give relevant handler button to start edit profile task which will give the similar text based input that user answered during register and ask to skip or give updated answer and after the last input it will validate and update the profile accordingly or show error message and try again. And the user can directly run the /edit-profile handler too.

The user can ask the AI to delete the account, where the AI can give relevant handler button to delete the role task, which will create new task and ask the user confirmation to delete as trainer or trainee and delete trainer related data that is not affecting other users. If confirmed then delete the data for the user, and delete the selected role id field in user table and if no opposite role id then delete the user table entry too. And the user can directly run the /delete-account handler too.

The user can also stop running tasks. At the beginning of each task, the AI will inform the user to run /stop to stop the task, and then the handler will mark the last task as stopped.

Based on your thoughtful and detailed development approach, here are my suggestions for implementing these trainer-trainee relationship features:

**For inviting existing trainees:** The trainer should be able to ask the AI to invite a trainee, where the AI can provide a handler button to start the invite trainee task. This task will ask the trainer to provide the trainee's id. The system will check if the trainee id exists in the trainee table. If found, the system will send an invitation message to that trainee with handler buttons to accept or reject the invitation. The invitation will include the trainer's basic info like name and id. If the trainee accepts, the system will add the trainer id to the trainee's subscribed trainer list and add the trainee id to the trainer's trainee list. If rejected, the system will notify the trainer that the invitation was declined. The trainer can directly run the /invite-trainee handler too.

**For inviting and creating new trainees:** The trainer should be able to ask the AI to create and invite a trainee, where the AI can provide a handler button to start the create trainee task. This task will ask the trainer to provide all the necessary trainee registration information from the client_registration_inputs.json file one by one, including the trainee's phone number. After the trainer provides all information, the system will check if that phone number already exists in the trainee table. If the number exists, the system will inform the trainer that the trainee already exists and display the trainee's id, then ask if the trainer wants to invite this existing trainee instead. If the trainer confirms, the system will proceed with the invite existing trainee flow using that trainee id. If the number does not exist, the system will send an invitation message to that phone number with the prefilled information displayed clearly, along with handler buttons to approve or reject the registration. If the user approves, the system will generate a unique trainee id (5-7 characters based on the trainee's name and join date, adding 2-3 numbers if needed to ensure uniqueness), create the trainee account with the provided information, create a user entry with the trainee id, mark logged in as trainee, add the trainer id to the trainee's subscribed trainer list, and add the trainee id to the trainer's trainee list. If rejected, the system will notify the trainer that the invitation was declined and the data will not be saved. The trainer can directly run the /create-trainee handler too.

**For trainee searching and inviting trainers:** The trainee should be able to ask the AI to search for trainers, where the AI can provide a handler button to start the search trainer task. This task will ask the trainee to provide the trainer name to search. The system will search the trainer table by matching the trainer name and return matching results with relevant trainer information like name, specialization, experience, and trainer id. The system will display up to 5 results at a time directly in the chat with each trainer's information. The trainee will need to copy the trainer id and tell the AI to send invite using that id. The trainee can then ask the AI to invite a specific trainer by providing the trainer id, where the AI will give a handler button to start the invite trainer task. This task will send an invitation message to that trainer with the trainee's basic info like name and id, along with handler buttons to accept or reject the invitation. If the trainer accepts, the system will add the trainer id to the trainee's subscribed trainer list and add the trainee id to the trainer's trainee list. If rejected, the system will notify the trainee that the invitation was declined. The trainee can directly run the /search-trainer and /invite-trainer handlers too.

**For viewing trainees and trainers:** The trainer should be able to ask the AI to view their trainees, where the AI can provide a handler button and the handler will retrieve all trainees from the trainer's trainee list with relevant information like name, contact, registration date, and trainee id. If the list is small (for example, less than 05 trainees), it will display the list directly in the chat. If the list is large, the system will provide a CSV downloadable file with all trainee information including trainee ids. The trainer can directly run the /view-trainees handler too. Similarly, the trainee should be able to ask the AI to view their trainers, where the AI can provide a handler button and the handler will retrieve all trainers from the trainee's subscribed trainer list with relevant information like name, specialization, contact, and trainer id. If the list is small (for example, less than 20 trainers), it will display the list directly in the chat. If the list is large, the system will provide a CSV downloadable file with all trainer information including trainer ids. The trainee can directly run the /view-trainers handler too.

**For removing relationships:** The trainer should be able to ask the AI to remove a trainee, where the AI can provide a handler button to start the remove trainee task. This task will ask the trainer to provide the trainee id. The system will verify the trainee id exists in the trainer's trainee list, then ask for confirmation to remove the trainee. If confirmed, the system will remove the trainee id from the trainer's trainee list and remove the trainer id from that trainee's subscribed trainer list. The system will notify both the trainer and the trainee about the removal. The trainee will need to send a new invite to be added again. The trainer can directly run the /remove-trainee handler too. Similarly, the trainee should be able to ask the AI to remove a trainer, where the AI can provide a handler button to start the remove trainer task. This task will ask the trainee to provide the trainer id. The system will verify the trainer id exists in the trainee's subscribed trainer list, then ask for confirmation to remove the trainer. If confirmed, the system will remove the trainer id from the trainee's subscribed trainer list and remove the trainee id from that trainer's trainee list. The system will notify both the trainee and the trainer about the removal. The trainee can directly run the /remove-trainer handler too.

**For trainer-created trainee accounts:** Any trainee created by a trainer will function exactly the same as a self-registered trainee. They will have full access to all trainee features including editing their profile using the edit profile task with the same text-based inputs from client_registration_inputs.json, asking to skip or provide updated answers, and the system will validate and update accordingly. They can also delete their own account using the delete account task, which will ask for confirmation and if confirmed will delete their trainee data that is not affecting other users, remove their trainee id from all trainers' trainee lists in the trainer's trainee list table, delete their own trainer list entries from the trainee's trainer list table, and delete the trainee id field in the user table, and if no trainer role id exists then delete the user table entry too.

**Updated delete account logic for trainees:** When a trainee deletes their account, the system will now also remove the trainee id from all associated trainers' trainee lists in the trainer's trainee list table and completely delete all entries from the trainee's trainer list table. This ensures complete cleanup of all relationship data.

**Updated delete account logic for trainers:** When a trainer deletes their account, the system will now also remove the trainer id from all associated trainees' subscribed trainer lists in the trainee's trainer list table and completely delete all entries from the trainer's trainee list table. This ensures complete cleanup of all relationship data.

**ID generation system:** Both trainer ids and trainee ids will be generated as unique identifiers of 5-7 characters, created using a combination of the user's name and join date. If the generated id already exists in the system, 2-3 additional numbers will be appended to make it unique. This ensures the ids are easy to type and remember while maintaining uniqueness across the platform.

**For creating fitness habits by trainer:** The trainer should be able to ask the AI to create a fitness habit, where the AI can provide a handler button to start the create habit task. This task will retrieve the necessary habit creation fields from a habit_creation_inputs.json file which will define all the required information to collect such as habit name (like water_intake, sleep_hours, daily_steps_walked, body_weight_monitoring, number_of_meals_logged), habit description, target value or goal, unit of measurement (like liters, hours, steps, kg, meals), and frequency (daily, weekly). The system will ask for each field one by one based on the JSON file configuration. After collecting all information, the system will save the habit in the fitness habit table with a unique habit id generated using the habit name and creation date (5-7 characters, adding 2-3 numbers if needed for uniqueness), and store the trainer id who created it. This approach allows easy customization of habit creation fields by simply updating the habit_creation_inputs.json file without changing the code. The trainer can directly run the /create-habit handler too.

**For editing fitness habits by trainer:** The trainer should be able to ask the AI to edit a habit, where the AI can provide a handler button to start the edit habit task. This task will ask the trainer to provide the habit id. The system will verify the habit belongs to this trainer, then display the current habit information and retrieve the editable fields from the habit_creation_inputs.json file. The task will go through each field defined in the JSON and ask the trainer which fields they want to update. The trainer can skip or provide updated answers for each field. After collecting all updates, the system will validate and update the habit accordingly or show error message and try again. The trainer can directly run the /edit-habit handler too.

**For deleting fitness habits by trainer:** The trainer should be able to ask the AI to delete a habit, where the AI can provide a handler button to start the delete habit task. This task will ask the trainer to provide the habit id. The system will verify the habit belongs to this trainer, then ask for confirmation to delete the habit. If confirmed, the system will delete the habit from the fitness habit table and remove all habit assignments from the trainee habit assignment table for this habit, and notify all assigned trainees that this habit has been removed by their trainer. The trainer can directly run the /delete-habit handler too.

**For assigning habits to trainees:** The trainer should be able to ask the AI to assign a habit to trainees, where the AI can provide a handler button to start the assign habit task. This task will ask the trainer to provide the habit id first. The system will verify the habit belongs to this trainer and display the habit details. Then the task will ask the trainer to provide one or more trainee ids (comma-separated or one by one). The system will verify each trainee id exists in the trainer's trainee list. After collecting all trainee ids, the system will create entries in the trainee habit assignment table linking each trainee id with the habit id, set the assignment date, and send notification messages to each assigned trainee informing them about the new habit with the habit details and target goals. The trainer can directly run the /assign-habit handler too.

**For viewing created habits by trainer:** The trainer should be able to ask the AI to view created habits, where the AI can provide a handler button and the handler will retrieve all habits created by the trainer from the fitness habit table with relevant information like habit name, description, target value, unit, frequency, number of assigned trainees, and habit id. If the list has 5 or fewer habits, it will display the list directly in the chat. If the list has more than 5 habits, the system will provide a CSV downloadable file with all habit information including habit ids. The trainer can directly run the /view-habits handler too.

**For viewing assigned habits by trainee:** The trainee should be able to ask the AI to view their assigned habits, where the AI can provide a handler button and the handler will retrieve all habits assigned to the trainee from the trainee habit assignment table with relevant information like habit name, description, target value, unit, frequency, assigned by which trainer name, assignment date, and habit id. The system will display all assigned habits directly in the chat. The trainee can directly run the /view-my-habits handler too.

**For daily habit reminder and logging by trainee:** Every day at a scheduled time (for example, morning 8 AM), the system will automatically send a message to each trainee who has assigned habits, listing all their habits for the day with habit names, target values, and units. The message will include a handler button to start logging their daily habit progress. When the trainee clicks the button or asks the AI to log habits, the AI will provide a handler button to start the log habits task. This task will go through each assigned habit one by one and ask the trainee to provide the actual value completed for that habit (like how many liters of water consumed, how many hours slept, how many steps walked). After collecting the value for each habit, the system will save the data in the habit log table with the trainee id, habit id, log date and time, and completed value only. The trainee can log habits multiple times throughout the day, and each log entry will be saved separately with its timestamp. After saving, the system will retrieve the target value from the habit table based on the habit id, calculate the total completed value by summing all log entries for that habit for that day, calculate the due value (target value minus total completed value), and calculate the completion percentage (total completed value divided by target value times 100), then display a summary showing each habit with total completed value, due value, and completion percentage. The trainee can directly run the /log-habits handler too.

**For viewing habit progress by trainee:** The trainee should be able to ask the AI to view habit progress for a specific day, where the AI can provide a handler button to start the view progress task. This task will ask the trainee to provide the date (day, month, year) they want to view. The system will retrieve all habit logs for that trainee for the specified date from the habit log table, group them by habit id, and for each habit retrieve the target value from the habit table, sum all completed values logged for that day, calculate the due value (target value minus total completed value), and calculate the completion percentage (total completed value divided by target value times 100). The system will then display each habit with habit name, target value, total completed value, due value, and completion percentage. If no logs exist for that date, the system will inform the trainee that no habit logs were found for that date. The trainee can directly run the /view-progress handler too.

**For requesting progress reports by trainee:** The trainee should be able to ask the AI for a progress report, where the AI can provide handler buttons for weekly report or monthly report. When the trainee clicks weekly report button, the task will ask which week (provide start date or week number and year). When the trainee clicks monthly report button, the task will ask which month and year. After collecting the time period, the system will retrieve all habit logs for that trainee for the specified period from the habit log table, and for each day and each habit, retrieve the target value from the habit table, sum all completed values logged for that day, calculate the due value (target value minus total completed value), and calculate the completion percentage (total completed value divided by target value times 100). The system will generate a CSV file containing date, habit name, target value, total completed value, due value, completion percentage for each day and each habit, with summary statistics like average completion percentage per habit, total days logged, and overall completion rate. The system will provide the CSV file for download. The trainee can directly run the /weekly-report or /monthly-report handlers too.

**For viewing trainee habit progress by trainer:** The trainer should be able to ask the AI to view a trainee's habit progress, where the AI can provide a handler button to start the view trainee progress task. This task will ask the trainer to provide the trainee id first. The system will verify the trainee id exists in the trainer's trainee list. Then the task will ask the trainer to provide the date (day, month, year) they want to view. The system will retrieve all habit logs for that trainee for the specified date from the habit log table, group them by habit id, and for each habit retrieve the target value from the habit table, sum all completed values logged for that day, calculate the due value (target value minus total completed value), and calculate the completion percentage (total completed value divided by target value times 100). The system will then display each habit with habit name, target value, total completed value, due value, and completion percentage. If no logs exist for that date, the system will inform the trainer that no habit logs were found for that trainee on that date. The trainer can directly run the /view-trainee-progress handler too.

**For requesting trainee progress reports by trainer:** The trainer should be able to ask the AI for a trainee's progress report, where the AI can provide a handler button to start the trainee report task. This task will ask the trainer to provide the trainee id first. The system will verify the trainee id exists in the trainer's trainee list. Then the AI will provide handler buttons for weekly report or monthly report. When the trainer clicks weekly report button, the task will ask which week (provide start date or week number and year). When the trainer clicks monthly report button, the task will ask which month and year. After collecting the time period, the system will retrieve all habit logs for that trainee for the specified period from the habit log table, and for each day and each habit, retrieve the target value from the habit table, sum all completed values logged for that day, calculate the due value (target value minus total completed value), and calculate the completion percentage (total completed value divided by target value times 100). The system will generate a CSV file containing date, habit name, target value, total completed value, due value, completion percentage for each day and each habit, with summary statistics like average completion percentage per habit, total days logged, and overall completion rate. The system will provide the CSV file for download. The trainer can directly run the /trainee-weekly-report or /trainee-monthly-report handlers too.

**Data integrity for habit logs:** The trainee will not be able to edit or delete any entries in the habit log table. Once a habit value is logged, that data becomes permanent and immutable to maintain accurate progress tracking and historical records. The trainee can however log additional values for the same habit on the same day, which will be added as new entries and all values will be summed together when calculating progress. This ensures data integrity and prevents manipulation of progress records while allowing flexible logging throughout the day.
