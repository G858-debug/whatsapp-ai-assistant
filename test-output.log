============================= test session starts ==============================
platform linux -- Python 3.11.13, pytest-7.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
cachedir: .pytest_cache
metadata: {'Python': '3.11.13', 'Platform': 'Linux-6.11.0-1018-azure-x86_64-with-glibc2.39', 'Packages': {'pytest': '7.4.2', 'pluggy': '1.6.0'}, 'Plugins': {'anyio': '4.11.0', 'html': '4.1.1', 'json-report': '1.5.0', 'cov': '4.1.0', 'metadata': '3.1.1'}, 'CI': 'true', 'JAVA_HOME': '/usr/lib/jvm/temurin-17-jdk-amd64'}
rootdir: /home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant
plugins: anyio-4.11.0, html-4.1.1, json-report-1.5.0, cov-4.1.0, metadata-3.1.1
collecting ... collected 69 items

tests/test_conversation_flows.py::TestBasicFunctionality::test_imports_work PASSED
tests/test_conversation_flows.py::TestBasicFunctionality::test_mock_message PASSED
tests/test_conversation_flows.py::TestBasicFunctionality::test_trainer_registration_mock PASSED
tests/test_conversation_flows.py::TestPhase1_Registration::test_basic_setup PASSED
tests/test_conversation_flows.py::TestPhase1_Registration::test_mock_registration_flow PASSED
tests/test_debug.py::test_python_version Python version: 3.11.13 (main, Jun  4 2025, 04:12:12) [GCC 13.3.0]
PASSED
tests/test_debug.py::test_can_import_basic_modules âœ… pytest imported successfully
âœ… json imported successfully
PASSED
tests/test_debug.py::test_project_structure Current directory: /home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant
Directory contents: ['nixpacks.toml', 'apply-fixes.log', 'models', 'requirements.txt', 'summary.txt', '.git', 'fix_test_issues.py', 'utils', 'payfast_webhook.py', 'test-output.log', 'services', '.github', 'claude_response.md', 'claude.md', 'static', 'app_routes.py', 'test_railway_api.py', 'voice_helpers.py', '__pycache__', 'fix-generator.log', 'backups', '.gitignore', '.test_failure_history.json', 'README.md', 'payment_manager.py', '.claude-config.json', 'routes', 'test-results.json', 'test-report.html', 'Procfile', 'tests', 'payment_integration.py', 'debug_time.py', 'config.py', 'app.py', 'app_core.py', 'templates', 'comment.txt', 'runtime.txt', 'supabase']
âœ… services/ directory exists
   Contents: ['payment_commands.py', 'text_variation_handler.py', 'helpers', 'calendar_service.py', 'refiloe_handlers.py']...
âœ… utils/ directory exists
   Contents: ['phone_utils.py', 'logger.py', 'rate_limiter.py', 'railway_api.py', '__pycache__']...
PASSED
tests/test_debug.py::test_can_import_refiloe_modules âœ… services.refiloe imported successfully
âœ… services.ai_intent_handler imported successfully
âœ… services.registration.trainer_registration imported successfully
âœ… utils.logger imported successfully
âœ… config imported successfully
PASSED
tests/test_debug.py::test_check_requirements âœ… flask is installed
âœ… supabase is installed
âœ… anthropic is installed
âœ… pytz is installed
âœ… requests is installed
PASSED
tests/test_e2e_complete.py::TestPhase1_Registration::test_complete_trainer_onboarding ERROR
tests/test_e2e_complete.py::TestPhase1_Registration::test_trainer_recognition_after_registration ERROR
tests/test_e2e_complete.py::TestPhase2_ClientManagement::test_add_client_variations ERROR
tests/test_e2e_complete.py::TestPhase2_ClientManagement::test_view_clients ERROR
tests/test_e2e_complete.py::TestPhase2_ClientManagement::test_custom_pricing ERROR
tests/test_e2e_complete.py::TestPhase3_Scheduling::test_view_schedule ERROR
tests/test_e2e_complete.py::TestPhase3_Scheduling::test_book_sessions ERROR
tests/test_e2e_complete.py::TestPhase3_Scheduling::test_cancel_reschedule ERROR
tests/test_integration_real.py::TestRealIntegration::test_trainer_registration_database Checking if tables exist...
âœ… trainers table exists
âœ… Trainer created with ID: 41a4d1fe-a1cf-4271-8cd5-033ece8a4183
PASSED
tests/test_integration_real.py::TestRealIntegration::test_client_management_real âœ… Client created for trainer 5b81ebfe-7c29-4c2a-a423-901ddaa2547a
PASSED
tests/test_integration_real.py::TestRealIntegration::test_booking_system_real FAILED
tests/test_integration_real.py::TestRealIntegration::test_ai_integration_simple SKIPPED
tests/test_integration_real.py::TestRealIntegration::test_database_connection âœ… Database connection successful
PASSEDâœ… Test data cleaned up

tests/test_phase1_registration.py::TestTrainerRegistrationReal::test_complete_trainer_registration_flow PASSED
tests/test_phase1_registration.py::TestTrainerRegistrationReal::test_currency_parsing_variations PASSED
tests/test_phase1_registration.py::TestTrainerRegistrationReal::test_registration_with_missing_fields PASSED
tests/test_phase1_registration.py::TestTrainerRegistrationReal::test_trainer_recognition_after_registration FAILED
tests/test_phase1_registration.py::TestClientRegistrationReal::test_client_receives_welcome_after_registration FAILED
tests/test_phase1_registration.py::TestRegistrationEdgeCases::test_duplicate_registration_attempt PASSED
tests/test_phase1_registration.py::TestRegistrationEdgeCases::test_invalid_email_format PASSED
tests/test_phase1_registration.py::TestRegistrationEdgeCases::test_extremely_long_input PASSED
tests/test_phase1_registration.py::TestRegistrationEdgeCases::test_special_characters_in_name PASSED
tests/test_phase2_client_management.py::TestAddClientReal::test_add_client_command_variations PASSED
tests/test_phase2_client_management.py::TestAddClientReal::test_phone_number_normalization PASSED
tests/test_phase2_client_management.py::TestAddClientReal::test_add_client_with_special_names PASSED
tests/test_phase2_client_management.py::TestViewClientsReal::test_view_clients_commands FAILED
tests/test_phase2_client_management.py::TestCustomPricingReal::test_set_custom_pricing_variations PASSED
tests/test_phase2_client_management.py::TestCustomPricingReal::test_check_client_pricing FAILED
tests/test_phase2_client_management.py::TestClientManagementEdgeCases::test_add_client_with_duplicate_phone FAILED
tests/test_phase2_client_management.py::TestClientManagementEdgeCases::test_invalid_phone_numbers PASSED
tests/test_phase2_client_management.py::TestClientManagementEdgeCases::test_set_negative_pricing PASSED
tests/test_phase2_client_management.py::TestClientManagementEdgeCases::test_client_not_found FAILED
tests/test_phase3_scheduling.py::TestViewScheduleReal::test_view_schedule_commands FAILED
tests/test_phase3_scheduling.py::TestBookSessionsReal::test_book_session_natural_language PASSED
tests/test_phase3_scheduling.py::TestBookSessionsReal::test_booking_time_formats PASSED
tests/test_phase3_scheduling.py::TestBookSessionsReal::test_booking_date_parsing PASSED
tests/test_phase3_scheduling.py::TestCancelRescheduleReal::test_cancel_booking_variations PASSED
tests/test_phase3_scheduling.py::TestCancelRescheduleReal::test_reschedule_booking PASSED
tests/test_phase3_scheduling.py::TestBookingConflictsAndValidation::test_double_booking_prevention PASSED
tests/test_phase3_scheduling.py::TestBookingConflictsAndValidation::test_past_date_booking_prevention PASSED
tests/test_phase3_scheduling.py::TestBookingConflictsAndValidation::test_invalid_time_slots PASSED
tests/test_refiloe_complete.py::TestPhase1_UserRegistration::test_new_trainer_onboarding PASSED
tests/test_refiloe_complete.py::TestPhase1_UserRegistration::test_trainer_recognition PASSED
tests/test_refiloe_complete.py::TestPhase2_ClientManagement::test_add_client_variations PASSED
tests/test_refiloe_complete.py::TestPhase2_ClientManagement::test_view_clients PASSED
tests/test_refiloe_complete.py::TestPhase2_ClientManagement::test_set_custom_pricing PASSED
tests/test_refiloe_complete.py::TestPhase3_SchedulingBookings::test_view_schedule PASSED
tests/test_refiloe_complete.py::TestPhase3_SchedulingBookings::test_book_sessions PASSED
tests/test_refiloe_complete.py::TestPhase3_SchedulingBookings::test_cancel_reschedule FAILED
tests/test_refiloe_complete.py::TestPhase4_HabitTracking::test_setup_habits PASSED
tests/test_refiloe_complete.py::TestPhase5_WorkoutsAssessments::test_send_workouts PASSED
tests/test_refiloe_complete.py::TestPhase6_PaymentsRevenue::test_request_payment FAILED
tests/test_refiloe_complete.py::TestPhase6_PaymentsRevenue::test_check_revenue PASSED
tests/test_refiloe_complete.py::TestPhase8_ClientFeatures::test_client_booking PASSED
tests/test_refiloe_complete.py::TestPhase8_ClientFeatures::test_client_habit_logging PASSED
tests/test_refiloe_complete.py::TestPhase10_AdvancedFeatures::test_natural_language_understanding PASSED
tests/test_refiloe_complete.py::TestPhase10_AdvancedFeatures::test_error_handling FAILED
tests/test_refiloe_complete.py::TestCriticalBugs::test_trainer_registration_step_7_currency_parsing PASSED
tests/test_refiloe_complete.py::TestCriticalBugs::test_ai_responds_naturally_not_rigid_commands PASSED

==================================== ERRORS ====================================
__ ERROR at setup of TestPhase1_Registration.test_complete_trainer_onboarding __
tests/test_e2e_complete.py:91: in setup_method
    self.tester = RefiloeE2ETester()
tests/test_e2e_complete.py:31: in __init__
    from app_core import process_whatsapp_message
E   ImportError: cannot import name 'process_whatsapp_message' from 'app_core' (/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/app_core.py)
_ ERROR at setup of TestPhase1_Registration.test_trainer_recognition_after_registration _
tests/test_e2e_complete.py:91: in setup_method
    self.tester = RefiloeE2ETester()
tests/test_e2e_complete.py:31: in __init__
    from app_core import process_whatsapp_message
E   ImportError: cannot import name 'process_whatsapp_message' from 'app_core' (/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/app_core.py)
___ ERROR at setup of TestPhase2_ClientManagement.test_add_client_variations ___
tests/test_e2e_complete.py:166: in setup_method
    self.tester = RefiloeE2ETester()
tests/test_e2e_complete.py:31: in __init__
    from app_core import process_whatsapp_message
E   ImportError: cannot import name 'process_whatsapp_message' from 'app_core' (/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/app_core.py)
_______ ERROR at setup of TestPhase2_ClientManagement.test_view_clients ________
tests/test_e2e_complete.py:166: in setup_method
    self.tester = RefiloeE2ETester()
tests/test_e2e_complete.py:31: in __init__
    from app_core import process_whatsapp_message
E   ImportError: cannot import name 'process_whatsapp_message' from 'app_core' (/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/app_core.py)
______ ERROR at setup of TestPhase2_ClientManagement.test_custom_pricing _______
tests/test_e2e_complete.py:166: in setup_method
    self.tester = RefiloeE2ETester()
tests/test_e2e_complete.py:31: in __init__
    from app_core import process_whatsapp_message
E   ImportError: cannot import name 'process_whatsapp_message' from 'app_core' (/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/app_core.py)
__________ ERROR at setup of TestPhase3_Scheduling.test_view_schedule __________
tests/test_e2e_complete.py:247: in setup_method
    self.tester = RefiloeE2ETester()
tests/test_e2e_complete.py:31: in __init__
    from app_core import process_whatsapp_message
E   ImportError: cannot import name 'process_whatsapp_message' from 'app_core' (/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/app_core.py)
__________ ERROR at setup of TestPhase3_Scheduling.test_book_sessions __________
tests/test_e2e_complete.py:247: in setup_method
    self.tester = RefiloeE2ETester()
tests/test_e2e_complete.py:31: in __init__
    from app_core import process_whatsapp_message
E   ImportError: cannot import name 'process_whatsapp_message' from 'app_core' (/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/app_core.py)
________ ERROR at setup of TestPhase3_Scheduling.test_cancel_reschedule ________
tests/test_e2e_complete.py:247: in setup_method
    self.tester = RefiloeE2ETester()
tests/test_e2e_complete.py:31: in __init__
    from app_core import process_whatsapp_message
E   ImportError: cannot import name 'process_whatsapp_message' from 'app_core' (/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/app_core.py)
=================================== FAILURES ===================================
_________________ TestRealIntegration.test_booking_system_real _________________
tests/test_integration_real.py:182: in test_booking_system_real
    }).execute()
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/postgrest/_sync/request_builder.py:70: in execute
    raise APIError(r.json())
E   postgrest.exceptions.APIError: {'code': 'PGRST204', 'details': None, 'hint': None, 'message': "Could not find the 'booking_date' column of 'bookings' in the schema cache"}
___ TestTrainerRegistrationReal.test_trainer_recognition_after_registration ____
tests/test_phase1_registration.py:253: in test_trainer_recognition_after_registration
    assert 'john' in response.get('response', '').lower() or \
E   assert ('john' in "hey there <magicmock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ" or 'welcome' in "hey there <magicmock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ")
E    +  where "hey there <magicmock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ" = <built-in method lower of str object at 0x7f9ffd5c3870>()
E    +    where <built-in method lower of str object at 0x7f9ffd5c3870> = "Hey there <MagicMock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ".lower
E    +      where "Hey there <MagicMock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ" = <built-in method get of dict object at 0x7f9ffdd234c0>('response', '')
E    +        where <built-in method get of dict object at 0x7f9ffdd234c0> = {'response': "Hey there <MagicMock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ", 'success': True}.get
E    +  and   "hey there <magicmock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ" = <built-in method lower of str object at 0x7f9ffd5c3870>()
E    +    where <built-in method lower of str object at 0x7f9ffd5c3870> = "Hey there <MagicMock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ".lower
E    +      where "Hey there <MagicMock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ" = <built-in method get of dict object at 0x7f9ffdd234c0>('response', '')
E    +        where <built-in method get of dict object at 0x7f9ffdd234c0> = {'response': "Hey there <MagicMock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ", 'success': True}.get
------------------------------ Captured log call -------------------------------
INFO     refiloe:logger.py:21 AI Intent Handler initialized with Claude
INFO     refiloe:logger.py:21 Background scheduler started
INFO     refiloe:logger.py:21 Routes setup complete
ERROR    refiloe:logger.py:25 AI intent understanding failed: Object of type MagicMock is not JSON serializable
Traceback (most recent call last):
  File "/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/services/ai_intent_handler.py", line 56, in understand_message
    prompt = self._create_intent_prompt(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/services/ai_intent_handler.py", line 121, in _create_intent_prompt
    {json.dumps(context, indent=2)}
     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/json/encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type MagicMock is not JSON serializable
ERROR    refiloe:logger.py:25 Failed to send message: {"error":{"message":"Invalid OAuth access token - Cannot parse access token","type":"OAuthException","code":190,"fbtrace_id":"AGDwBYXLP4fmyDEv5T3l1bE"}}
__ TestClientRegistrationReal.test_client_receives_welcome_after_registration __
tests/test_phase1_registration.py:297: in test_client_receives_welcome_after_registration
    assert response.get('success') == True
E   assert False == True
E    +  where False = <built-in method get of dict object at 0x7f9ffc1b7900>('success')
E    +    where <built-in method get of dict object at 0x7f9ffc1b7900> = {'response': "Sorry, I'm having a bit of trouble right now. Please try again in a moment! ðŸ˜Š", 'success': False}.get
------------------------------ Captured log call -------------------------------
ERROR    refiloe:logger.py:25 Error getting user context: 'list' object has no attribute 'get'
ERROR    refiloe:logger.py:25 Error handling message: 'list' object has no attribute 'get'
________________ TestViewClientsReal.test_view_clients_commands ________________
tests/test_phase2_client_management.py:160: in test_view_clients_commands
    assert 'sarah' in message or 'john' in message or 'mike' in message or \
E   AssertionError: Failed to list clients with command: Show my clients
E   assert ('sarah' in '' or 'john' in '' or 'mike' in '' or 'client' in '')
------------------------------ Captured log call -------------------------------
ERROR    refiloe:logger.py:25 Error getting user context: Mock.keys() returned a non-iterable (type Mock)
ERROR    refiloe:logger.py:25 Error getting conversation history: 'Mock' object is not reversible
ERROR    refiloe:logger.py:25 AI intent understanding failed: Error code: 404 - {'type': 'error', 'error': {'type': 'not_found_error', 'message': 'model: claude-sonnet-4-20250822'}, 'request_id': 'req_011CTXJMZG6jGS3V9CewEcc4'}
Traceback (most recent call last):
  File "/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/services/ai_intent_handler.py", line 64, in understand_message
    response = self.client.messages.create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_utils/_utils.py", line 275, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/resources/messages.py", line 888, in create
    return self._post(
           ^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_base_client.py", line 1277, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_base_client.py", line 954, in request
    return self._request(
           ^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_base_client.py", line 1058, in _request
    raise self._make_status_error_from_response(err.response) from None
anthropic.NotFoundError: Error code: 404 - {'type': 'error', 'error': {'type': 'not_found_error', 'message': 'model: claude-sonnet-4-20250822'}, 'request_id': 'req_011CTXJMZG6jGS3V9CewEcc4'}
ERROR    refiloe:logger.py:25 Failed to send button message: {"error":{"message":"Invalid OAuth access token - Cannot parse access token","type":"OAuthException","code":190,"fbtrace_id":"AavuvoNVCYK66nbM597S4Pi"}}
INFO     refiloe:logger.py:21 Updated conversation state for 27731863036: AWAITING_REGISTRATION_CHOICE
_______________ TestCustomPricingReal.test_check_client_pricing ________________
tests/test_phase2_client_management.py:239: in test_check_client_pricing
    assert 'r' in message or 'rand' in message or \
E   AssertionError: Failed to show pricing with: What is Sarah's rate?
E   assert ('r' in '' or 'rand' in '' or False)
E    +  where False = any(<generator object TestCustomPricingReal.test_check_client_pricing.<locals>.<genexpr> at 0x7f9ffd2b6960>)
------------------------------ Captured log call -------------------------------
ERROR    refiloe:logger.py:25 Error getting user context: object of type 'Mock' has no len()
ERROR    refiloe:logger.py:25 Error getting conversation history: 'Mock' object is not reversible
ERROR    refiloe:logger.py:25 AI intent understanding failed: Error code: 404 - {'type': 'error', 'error': {'type': 'not_found_error', 'message': 'model: claude-sonnet-4-20250822'}, 'request_id': 'req_011CTXJMmdjfRetjKJ1b1zRz'}
Traceback (most recent call last):
  File "/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/services/ai_intent_handler.py", line 64, in understand_message
    response = self.client.messages.create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_utils/_utils.py", line 275, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/resources/messages.py", line 888, in create
    return self._post(
           ^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_base_client.py", line 1277, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_base_client.py", line 954, in request
    return self._request(
           ^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_base_client.py", line 1058, in _request
    raise self._make_status_error_from_response(err.response) from None
anthropic.NotFoundError: Error code: 404 - {'type': 'error', 'error': {'type': 'not_found_error', 'message': 'model: claude-sonnet-4-20250822'}, 'request_id': 'req_011CTXJMmdjfRetjKJ1b1zRz'}
ERROR    refiloe:logger.py:25 Failed to send button message: {"error":{"message":"Invalid OAuth access token - Cannot parse access token","type":"OAuthException","code":190,"fbtrace_id":"AArASy2Yufv9AYz1-ZDU6mf"}}
INFO     refiloe:logger.py:21 Updated conversation state for 27731863036: AWAITING_REGISTRATION_CHOICE
______ TestClientManagementEdgeCases.test_add_client_with_duplicate_phone ______
tests/test_phase2_client_management.py:268: in test_add_client_with_duplicate_phone
    assert 'already' in response.get('message', '').lower() or \
E   assert ('already' in '' or 'exists' in '')
E    +  where '' = <built-in method lower of str object at 0x7fa01013fba0>()
E    +    where <built-in method lower of str object at 0x7fa01013fba0> = ''.lower
E    +      where '' = <built-in method get of dict object at 0x7f9ffc19a280>('message', '')
E    +        where <built-in method get of dict object at 0x7f9ffc19a280> = {'response': "My apologies, I'm having trouble understanding this request. I'll let Support know about this. In the meantime, are you looking to manage clients, check your schedule, or something else?", 'success': True}.get
E    +  and   '' = <built-in method lower of str object at 0x7fa01013fba0>()
E    +    where <built-in method lower of str object at 0x7fa01013fba0> = ''.lower
E    +      where '' = <built-in method get of dict object at 0x7f9ffc19a280>('message', '')
E    +        where <built-in method get of dict object at 0x7f9ffc19a280> = {'response': "My apologies, I'm having trouble understanding this request. I'll let Support know about this. In the meantime, are you looking to manage clients, check your schedule, or something else?", 'success': True}.get
------------------------------ Captured log call -------------------------------
ERROR    refiloe:logger.py:25 Error getting user context: object of type 'Mock' has no len()
ERROR    refiloe:logger.py:25 Error getting conversation history: 'Mock' object is not reversible
ERROR    refiloe:logger.py:25 AI intent understanding failed: Error code: 404 - {'type': 'error', 'error': {'type': 'not_found_error', 'message': 'model: claude-sonnet-4-20250822'}, 'request_id': 'req_011CTXJMpWsj8YQpCk1ip3u5'}
Traceback (most recent call last):
  File "/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/services/ai_intent_handler.py", line 64, in understand_message
    response = self.client.messages.create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_utils/_utils.py", line 275, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/resources/messages.py", line 888, in create
    return self._post(
           ^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_base_client.py", line 1277, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_base_client.py", line 954, in request
    return self._request(
           ^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_base_client.py", line 1058, in _request
    raise self._make_status_error_from_response(err.response) from None
anthropic.NotFoundError: Error code: 404 - {'type': 'error', 'error': {'type': 'not_found_error', 'message': 'model: claude-sonnet-4-20250822'}, 'request_id': 'req_011CTXJMpWsj8YQpCk1ip3u5'}
ERROR    refiloe:logger.py:25 Failed to send message: {"error":{"message":"Invalid OAuth access token - Cannot parse access token","type":"OAuthException","code":190,"fbtrace_id":"ARYmXU-DTcteNvLbUT2kEtG"}}
_____________ TestClientManagementEdgeCases.test_client_not_found ______________
tests/test_phase2_client_management.py:311: in test_client_not_found
    assert 'not found' in response.get('message', '').lower() or \
E   assert ('not found' in '' or "doesn't exist" in '' or 'no client' in '')
E    +  where '' = <built-in method lower of str object at 0x7fa01013fba0>()
E    +    where <built-in method lower of str object at 0x7fa01013fba0> = ''.lower
E    +      where '' = <built-in method get of dict object at 0x7f9ffc179380>('message', '')
E    +        where <built-in method get of dict object at 0x7f9ffc179380> = {'response': "My apologies, I'm having trouble understanding this request. I'll let Support know about this. In the meantime, are you looking to manage clients, check your schedule, or something else?\n\nLet's get you started on your fitness journey! ðŸš€\n\nHow can I help you today?", 'success': True}.get
E    +  and   '' = <built-in method lower of str object at 0x7fa01013fba0>()
E    +    where <built-in method lower of str object at 0x7fa01013fba0> = ''.lower
E    +      where '' = <built-in method get of dict object at 0x7f9ffc179380>('message', '')
E    +        where <built-in method get of dict object at 0x7f9ffc179380> = {'response': "My apologies, I'm having trouble understanding this request. I'll let Support know about this. In the meantime, are you looking to manage clients, check your schedule, or something else?\n\nLet's get you started on your fitness journey! ðŸš€\n\nHow can I help you today?", 'success': True}.get
E    +  and   '' = <built-in method lower of str object at 0x7fa01013fba0>()
E    +    where <built-in method lower of str object at 0x7fa01013fba0> = ''.lower
E    +      where '' = <built-in method get of dict object at 0x7f9ffc179380>('message', '')
E    +        where <built-in method get of dict object at 0x7f9ffc179380> = {'response': "My apologies, I'm having trouble understanding this request. I'll let Support know about this. In the meantime, are you looking to manage clients, check your schedule, or something else?\n\nLet's get you started on your fitness journey! ðŸš€\n\nHow can I help you today?", 'success': True}.get
------------------------------ Captured log call -------------------------------
ERROR    refiloe:logger.py:25 Error getting conversation history: 'Mock' object is not reversible
ERROR    refiloe:logger.py:25 Error creating conversation state: 'Mock' object is not subscriptable
ERROR    refiloe:logger.py:25 AI intent understanding failed: Error code: 404 - {'type': 'error', 'error': {'type': 'not_found_error', 'message': 'model: claude-sonnet-4-20250822'}, 'request_id': 'req_011CTXJMwjhsAELMDwa4xRny'}
Traceback (most recent call last):
  File "/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/services/ai_intent_handler.py", line 64, in understand_message
    response = self.client.messages.create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_utils/_utils.py", line 275, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/resources/messages.py", line 888, in create
    return self._post(
           ^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_base_client.py", line 1277, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_base_client.py", line 954, in request
    return self._request(
           ^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_base_client.py", line 1058, in _request
    raise self._make_status_error_from_response(err.response) from None
anthropic.NotFoundError: Error code: 404 - {'type': 'error', 'error': {'type': 'not_found_error', 'message': 'model: claude-sonnet-4-20250822'}, 'request_id': 'req_011CTXJMwjhsAELMDwa4xRny'}
ERROR    refiloe:logger.py:25 Failed to send button message: {"error":{"message":"Invalid OAuth access token - Cannot parse access token","type":"OAuthException","code":190,"fbtrace_id":"AUdV7lVBPqRtuykam4n7yY2"}}
INFO     refiloe:logger.py:21 Updated conversation state for 27731863036: AWAITING_REGISTRATION_CHOICE
_______________ TestViewScheduleReal.test_view_schedule_commands _______________
tests/test_phase3_scheduling.py:74: in test_view_schedule_commands
    assert 'schedule' in message or 'booking' in message or \
E   AssertionError: Failed to show schedule with: Show my schedule
E   assert ('schedule' in '' or 'booking' in '' or 'session' in '' or 'appointment' in '' or 'no bookings' in '' or 'free' in '')
------------------------------ Captured log call -------------------------------
ERROR    refiloe:logger.py:25 Error getting user context: Mock.keys() returned a non-iterable (type Mock)
ERROR    refiloe:logger.py:25 Error getting conversation history: 'Mock' object is not reversible
ERROR    refiloe:logger.py:25 AI intent understanding failed: Error code: 404 - {'type': 'error', 'error': {'type': 'not_found_error', 'message': 'model: claude-sonnet-4-20250822'}, 'request_id': 'req_011CTXJMzcb9rbffQXead6d2'}
Traceback (most recent call last):
  File "/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/services/ai_intent_handler.py", line 64, in understand_message
    response = self.client.messages.create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_utils/_utils.py", line 275, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/resources/messages.py", line 888, in create
    return self._post(
           ^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_base_client.py", line 1277, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_base_client.py", line 954, in request
    return self._request(
           ^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/anthropic/_base_client.py", line 1058, in _request
    raise self._make_status_error_from_response(err.response) from None
anthropic.NotFoundError: Error code: 404 - {'type': 'error', 'error': {'type': 'not_found_error', 'message': 'model: claude-sonnet-4-20250822'}, 'request_id': 'req_011CTXJMzcb9rbffQXead6d2'}
ERROR    refiloe:logger.py:25 Failed to send button message: {"error":{"message":"Invalid OAuth access token - Cannot parse access token","type":"OAuthException","code":190,"fbtrace_id":"AWsWUpPMN8CeT325jxeENA4"}}
INFO     refiloe:logger.py:21 Updated conversation state for 27731863036: AWAITING_REGISTRATION_CHOICE
_____________ TestPhase3_SchedulingBookings.test_cancel_reschedule _____________
tests/test_refiloe_complete.py:329: in test_cancel_reschedule
    assert "reschedul" in response['message'].lower() or "moved" in response['message'].lower()
E   assert ('reschedul' in "today's schedule:\n9:00 am - sarah johnson\n2:00 pm - john doe" or 'moved' in "today's schedule:\n9:00 am - sarah johnson\n2:00 pm - john doe")
E    +  where "today's schedule:\n9:00 am - sarah johnson\n2:00 pm - john doe" = <built-in method lower of str object at 0x7fa00c7d23a0>()
E    +    where <built-in method lower of str object at 0x7fa00c7d23a0> = "Today's schedule:\n9:00 AM - Sarah Johnson\n2:00 PM - John Doe".lower
E    +  and   "today's schedule:\n9:00 am - sarah johnson\n2:00 pm - john doe" = <built-in method lower of str object at 0x7fa00c7d23a0>()
E    +    where <built-in method lower of str object at 0x7fa00c7d23a0> = "Today's schedule:\n9:00 AM - Sarah Johnson\n2:00 PM - John Doe".lower
_______________ TestPhase6_PaymentsRevenue.test_request_payment ________________
tests/test_refiloe_complete.py:368: in test_request_payment
    assert "payment" in response['message'].lower() or "invoice" in response['message'].lower()
E   assert ('payment' in "welcome to refiloe! i'm here to help you manage your personal training business. are you a trainer or a client?" or 'invoice' in "welcome to refiloe! i'm here to help you manage your personal training business. are you a trainer or a client?")
E    +  where "welcome to refiloe! i'm here to help you manage your personal training business. are you a trainer or a client?" = <built-in method lower of str object at 0x7fa00c7d8170>()
E    +    where <built-in method lower of str object at 0x7fa00c7d8170> = "Welcome to Refiloe! I'm here to help you manage your personal training business. Are you a trainer or a client?".lower
E    +  and   "welcome to refiloe! i'm here to help you manage your personal training business. are you a trainer or a client?" = <built-in method lower of str object at 0x7fa00c7d8170>()
E    +    where <built-in method lower of str object at 0x7fa00c7d8170> = "Welcome to Refiloe! I'm here to help you manage your personal training business. Are you a trainer or a client?".lower
_______________ TestPhase10_AdvancedFeatures.test_error_handling _______________
tests/test_refiloe_complete.py:424: in test_error_handling
    assert any(word in response['message'].lower() for word in ["past", "future", "cannot"])
E   assert False
E    +  where False = any(<generator object TestPhase10_AdvancedFeatures.test_error_handling.<locals>.<genexpr> at 0x7f9ffd2b74c0>)
=============================== warnings summary ===============================
../../../../../opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/gotrue/types.py:679: 19 warnings
  /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/gotrue/types.py:679: PydanticDeprecatedSince20: The `update_forward_refs` method is deprecated; use `model_rebuild` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    model.update_forward_refs()

tests/test_e2e_complete.py::TestPhase1_Registration::test_complete_trainer_onboarding
  /home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/services/analytics.py:7: DeprecationWarning: 
  Pyarrow will become a required dependency of pandas in the next major release of pandas (pandas 3.0),
  (to allow more performant data types, such as the Arrow string type, and better interoperability with other libraries)
  but was not found to be installed on your system.
  If this would cause problems for you,
  please provide us feedback at https://github.com/pandas-dev/pandas/issues/54466
          
    import pandas as pd

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
--------------------------------- JSON report ----------------------------------
report saved to: test-results.json
- Generated html report: file:///home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/test-report.html -
=========================== short test summary info ============================
FAILED tests/test_integration_real.py::TestRealIntegration::test_booking_system_real - postgrest.exceptions.APIError: {'code': 'PGRST204', 'details': None, 'hint': None, 'message': "Could not find the 'booking_date' column of 'bookings' in the schema cache"}
FAILED tests/test_phase1_registration.py::TestTrainerRegistrationReal::test_trainer_recognition_after_registration - assert ('john' in "hey there <magicmock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ" or 'welcome' in "hey there <magicmock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ")
 +  where "hey there <magicmock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ" = <built-in method lower of str object at 0x7f9ffd5c3870>()
 +    where <built-in method lower of str object at 0x7f9ffd5c3870> = "Hey there <MagicMock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ".lower
 +      where "Hey there <MagicMock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ" = <built-in method get of dict object at 0x7f9ffdd234c0>('response', '')
 +        where <built-in method get of dict object at 0x7f9ffdd234c0> = {'response': "Hey there <MagicMock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ", 'success': True}.get
 +  and   "hey there <magicmock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ" = <built-in method lower of str object at 0x7f9ffd5c3870>()
 +    where <built-in method lower of str object at 0x7f9ffd5c3870> = "Hey there <MagicMock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ".lower
 +      where "Hey there <MagicMock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ" = <built-in method get of dict object at 0x7f9ffdd234c0>('response', '')
 +        where <built-in method get of dict object at 0x7f9ffdd234c0> = {'response': "Hey there <MagicMock name='mock.select().eq().single().execute().data.get()' id='140325124714320'>! ðŸ™Œ", 'success': True}.get
FAILED tests/test_phase1_registration.py::TestClientRegistrationReal::test_client_receives_welcome_after_registration - assert False == True
 +  where False = <built-in method get of dict object at 0x7f9ffc1b7900>('success')
 +    where <built-in method get of dict object at 0x7f9ffc1b7900> = {'response': "Sorry, I'm having a bit of trouble right now. Please try again in a moment! ðŸ˜Š", 'success': False}.get
FAILED tests/test_phase2_client_management.py::TestViewClientsReal::test_view_clients_commands - AssertionError: Failed to list clients with command: Show my clients
assert ('sarah' in '' or 'john' in '' or 'mike' in '' or 'client' in '')
FAILED tests/test_phase2_client_management.py::TestCustomPricingReal::test_check_client_pricing - AssertionError: Failed to show pricing with: What is Sarah's rate?
assert ('r' in '' or 'rand' in '' or False)
 +  where False = any(<generator object TestCustomPricingReal.test_check_client_pricing.<locals>.<genexpr> at 0x7f9ffd2b6960>)
FAILED tests/test_phase2_client_management.py::TestClientManagementEdgeCases::test_add_client_with_duplicate_phone - assert ('already' in '' or 'exists' in '')
 +  where '' = <built-in method lower of str object at 0x7fa01013fba0>()
 +    where <built-in method lower of str object at 0x7fa01013fba0> = ''.lower
 +      where '' = <built-in method get of dict object at 0x7f9ffc19a280>('message', '')
 +        where <built-in method get of dict object at 0x7f9ffc19a280> = {'response': "My apologies, I'm having trouble understanding this request. I'll let Support know about this. In the meantime, are you looking to manage clients, check your schedule, or something else?", 'success': True}.get
 +  and   '' = <built-in method lower of str object at 0x7fa01013fba0>()
 +    where <built-in method lower of str object at 0x7fa01013fba0> = ''.lower
 +      where '' = <built-in method get of dict object at 0x7f9ffc19a280>('message', '')
 +        where <built-in method get of dict object at 0x7f9ffc19a280> = {'response': "My apologies, I'm having trouble understanding this request. I'll let Support know about this. In the meantime, are you looking to manage clients, check your schedule, or something else?", 'success': True}.get
FAILED tests/test_phase2_client_management.py::TestClientManagementEdgeCases::test_client_not_found - assert ('not found' in '' or "doesn't exist" in '' or 'no client' in '')
 +  where '' = <built-in method lower of str object at 0x7fa01013fba0>()
 +    where <built-in method lower of str object at 0x7fa01013fba0> = ''.lower
 +      where '' = <built-in method get of dict object at 0x7f9ffc179380>('message', '')
 +        where <built-in method get of dict object at 0x7f9ffc179380> = {'response': "My apologies, I'm having trouble understanding this request. I'll let Support know about this. In the meantime, are you looking to manage clients, check your schedule, or something else?\n\nLet's get you started on your fitness journey! ðŸš€\n\nHow can I help you today?", 'success': True}.get
 +  and   '' = <built-in method lower of str object at 0x7fa01013fba0>()
 +    where <built-in method lower of str object at 0x7fa01013fba0> = ''.lower
 +      where '' = <built-in method get of dict object at 0x7f9ffc179380>('message', '')
 +        where <built-in method get of dict object at 0x7f9ffc179380> = {'response': "My apologies, I'm having trouble understanding this request. I'll let Support know about this. In the meantime, are you looking to manage clients, check your schedule, or something else?\n\nLet's get you started on your fitness journey! ðŸš€\n\nHow can I help you today?", 'success': True}.get
 +  and   '' = <built-in method lower of str object at 0x7fa01013fba0>()
 +    where <built-in method lower of str object at 0x7fa01013fba0> = ''.lower
 +      where '' = <built-in method get of dict object at 0x7f9ffc179380>('message', '')
 +        where <built-in method get of dict object at 0x7f9ffc179380> = {'response': "My apologies, I'm having trouble understanding this request. I'll let Support know about this. In the meantime, are you looking to manage clients, check your schedule, or something else?\n\nLet's get you started on your fitness journey! ðŸš€\n\nHow can I help you today?", 'success': True}.get
FAILED tests/test_phase3_scheduling.py::TestViewScheduleReal::test_view_schedule_commands - AssertionError: Failed to show schedule with: Show my schedule
assert ('schedule' in '' or 'booking' in '' or 'session' in '' or 'appointment' in '' or 'no bookings' in '' or 'free' in '')
FAILED tests/test_refiloe_complete.py::TestPhase3_SchedulingBookings::test_cancel_reschedule - assert ('reschedul' in "today's schedule:\n9:00 am - sarah johnson\n2:00 pm - john doe" or 'moved' in "today's schedule:\n9:00 am - sarah johnson\n2:00 pm - john doe")
 +  where "today's schedule:\n9:00 am - sarah johnson\n2:00 pm - john doe" = <built-in method lower of str object at 0x7fa00c7d23a0>()
 +    where <built-in method lower of str object at 0x7fa00c7d23a0> = "Today's schedule:\n9:00 AM - Sarah Johnson\n2:00 PM - John Doe".lower
 +  and   "today's schedule:\n9:00 am - sarah johnson\n2:00 pm - john doe" = <built-in method lower of str object at 0x7fa00c7d23a0>()
 +    where <built-in method lower of str object at 0x7fa00c7d23a0> = "Today's schedule:\n9:00 AM - Sarah Johnson\n2:00 PM - John Doe".lower
FAILED tests/test_refiloe_complete.py::TestPhase6_PaymentsRevenue::test_request_payment - assert ('payment' in "welcome to refiloe! i'm here to help you manage your personal training business. are you a trainer or a client?" or 'invoice' in "welcome to refiloe! i'm here to help you manage your personal training business. are you a trainer or a client?")
 +  where "welcome to refiloe! i'm here to help you manage your personal training business. are you a trainer or a client?" = <built-in method lower of str object at 0x7fa00c7d8170>()
 +    where <built-in method lower of str object at 0x7fa00c7d8170> = "Welcome to Refiloe! I'm here to help you manage your personal training business. Are you a trainer or a client?".lower
 +  and   "welcome to refiloe! i'm here to help you manage your personal training business. are you a trainer or a client?" = <built-in method lower of str object at 0x7fa00c7d8170>()
 +    where <built-in method lower of str object at 0x7fa00c7d8170> = "Welcome to Refiloe! I'm here to help you manage your personal training business. Are you a trainer or a client?".lower
FAILED tests/test_refiloe_complete.py::TestPhase10_AdvancedFeatures::test_error_handling - assert False
 +  where False = any(<generator object TestPhase10_AdvancedFeatures.test_error_handling.<locals>.<genexpr> at 0x7f9ffd2b74c0>)
ERROR tests/test_e2e_complete.py::TestPhase1_Registration::test_complete_trainer_onboarding - ImportError: cannot import name 'process_whatsapp_message' from 'app_core' (/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/app_core.py)
ERROR tests/test_e2e_complete.py::TestPhase1_Registration::test_trainer_recognition_after_registration - ImportError: cannot import name 'process_whatsapp_message' from 'app_core' (/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/app_core.py)
ERROR tests/test_e2e_complete.py::TestPhase2_ClientManagement::test_add_client_variations - ImportError: cannot import name 'process_whatsapp_message' from 'app_core' (/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/app_core.py)
ERROR tests/test_e2e_complete.py::TestPhase2_ClientManagement::test_view_clients - ImportError: cannot import name 'process_whatsapp_message' from 'app_core' (/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/app_core.py)
ERROR tests/test_e2e_complete.py::TestPhase2_ClientManagement::test_custom_pricing - ImportError: cannot import name 'process_whatsapp_message' from 'app_core' (/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/app_core.py)
ERROR tests/test_e2e_complete.py::TestPhase3_Scheduling::test_view_schedule - ImportError: cannot import name 'process_whatsapp_message' from 'app_core' (/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/app_core.py)
ERROR tests/test_e2e_complete.py::TestPhase3_Scheduling::test_book_sessions - ImportError: cannot import name 'process_whatsapp_message' from 'app_core' (/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/app_core.py)
ERROR tests/test_e2e_complete.py::TestPhase3_Scheduling::test_cancel_reschedule - ImportError: cannot import name 'process_whatsapp_message' from 'app_core' (/home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/app_core.py)
======= 11 failed, 49 passed, 1 skipped, 20 warnings, 8 errors in 51.57s =======
