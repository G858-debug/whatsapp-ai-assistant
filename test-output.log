============================= test session starts ==============================
platform linux -- Python 3.11.13, pytest-7.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.11.13/x64/bin/python
cachedir: .pytest_cache
metadata: {'Python': '3.11.13', 'Platform': 'Linux-6.11.0-1018-azure-x86_64-with-glibc2.39', 'Packages': {'pytest': '7.4.2', 'pluggy': '1.6.0'}, 'Plugins': {'anyio': '4.11.0', 'html': '4.1.1', 'json-report': '1.5.0', 'cov': '4.1.0', 'metadata': '3.1.1'}, 'CI': 'true', 'JAVA_HOME': '/usr/lib/jvm/temurin-17-jdk-amd64'}
rootdir: /home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant
plugins: anyio-4.11.0, html-4.1.1, json-report-1.5.0, cov-4.1.0, metadata-3.1.1
collecting ... collected 91 items

tests/test_conversation_flows.py::TestBasicFunctionality::test_imports_work PASSED
tests/test_conversation_flows.py::TestBasicFunctionality::test_mock_message PASSED
tests/test_conversation_flows.py::TestBasicFunctionality::test_trainer_registration_mock PASSED
tests/test_conversation_flows.py::TestPhase1_Registration::test_basic_setup PASSED
tests/test_conversation_flows.py::TestPhase1_Registration::test_mock_registration_flow PASSED
tests/test_debug.py::test_python_version Python version: 3.11.13 (main, Jun  4 2025, 04:12:12) [GCC 13.3.0]
PASSED
tests/test_debug.py::test_can_import_basic_modules âœ… pytest imported successfully
âœ… json imported successfully
PASSED
tests/test_debug.py::test_project_structure Current directory: /home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant
Directory contents: ['nixpacks.toml', 'apply-fixes.log', 'models', 'requirements.txt', 'summary.txt', '.git', 'fix_test_issues.py', 'utils', 'payfast_webhook.py', 'test-output.log', 'services', '.github', 'claude_response.md', 'claude.md', 'static', 'app_routes.py', 'test_railway_api.py', 'voice_helpers.py', '__pycache__', 'fix-generator.log', 'backups', '.gitignore', '.test_failure_history.json', 'README.md', 'payment_manager.py', '.claude-config.json', 'routes', 'test-results.json', 'test-report.html', 'Procfile', 'tests', 'payment_integration.py', 'debug_time.py', 'config.py', 'app.py', 'app_core.py', 'templates', 'comment.txt', 'runtime.txt', 'supabase']
âœ… services/ directory exists
   Contents: ['payment_commands.py', 'text_variation_handler.py', 'helpers', 'calendar_service.py', 'refiloe_handlers.py']...
âœ… utils/ directory exists
   Contents: ['phone_utils.py', 'logger.py', 'rate_limiter.py', 'railway_api.py', '__pycache__']...
PASSED
tests/test_debug.py::test_can_import_refiloe_modules âœ… services.refiloe imported successfully
âœ… services.ai_intent_handler imported successfully
âœ… services.registration.trainer_registration imported successfully
âœ… utils.logger imported successfully
âœ… config imported successfully
PASSED
tests/test_debug.py::test_check_requirements âœ… flask is installed
âœ… supabase is installed
âœ… anthropic is installed
âœ… pytz is installed
âœ… requests is installed
PASSED
tests/test_e2e_complete.py::TestPhase1_Registration::test_complete_trainer_onboarding ERROR
tests/test_e2e_complete.py::TestPhase1_Registration::test_trainer_recognition_after_registration ERROR
tests/test_e2e_complete.py::TestPhase2_ClientManagement::test_add_client_variations ERROR
tests/test_e2e_complete.py::TestPhase2_ClientManagement::test_view_clients ERROR
tests/test_e2e_complete.py::TestPhase2_ClientManagement::test_custom_pricing ERROR
tests/test_e2e_complete.py::TestPhase3_Scheduling::test_view_schedule ERROR
tests/test_e2e_complete.py::TestPhase3_Scheduling::test_book_sessions ERROR
tests/test_e2e_complete.py::TestPhase3_Scheduling::test_cancel_reschedule ERROR
tests/test_integration_real.py::TestRealIntegration::test_trainer_registration_database Checking if tables exist...
âœ… trainers table exists
âœ… Trainer created with ID: 4ef56ef6-186b-431f-a3de-4d1b2ce02fea
PASSED
tests/test_integration_real.py::TestRealIntegration::test_client_management_real âœ… Client created for trainer e62eaaa6-e956-4702-88a0-895ae3ffbde3
PASSED
tests/test_integration_real.py::TestRealIntegration::test_booking_system_real FAILED
tests/test_integration_real.py::TestRealIntegration::test_ai_integration_simple SKIPPED
tests/test_integration_real.py::TestRealIntegration::test_database_connection âœ… Database connection successful
PASSEDâœ… Test data cleaned up

tests/test_phase1_registration.py::TestTrainerRegistrationReal::test_complete_trainer_registration_flow PASSED
tests/test_phase1_registration.py::TestTrainerRegistrationReal::test_currency_parsing_variations PASSED
tests/test_phase1_registration.py::TestTrainerRegistrationReal::test_registration_with_missing_fields PASSED
tests/test_phase1_registration.py::TestTrainerRegistrationReal::test_trainer_recognition_after_registration FAILED
tests/test_phase1_registration.py::TestClientRegistrationReal::test_client_receives_welcome_after_registration FAILED
tests/test_phase1_registration.py::TestRegistrationEdgeCases::test_duplicate_registration_attempt PASSED
tests/test_phase1_registration.py::TestRegistrationEdgeCases::test_invalid_email_format PASSED
tests/test_phase1_registration.py::TestRegistrationEdgeCases::test_extremely_long_input PASSED
tests/test_phase1_registration.py::TestRegistrationEdgeCases::test_special_characters_in_name PASSED
tests/test_phase2_client_management.py::TestAddClientReal::test_add_client_command_variations PASSED
tests/test_phase2_client_management.py::TestAddClientReal::test_phone_number_normalization PASSED
tests/test_phase2_client_management.py::TestAddClientReal::test_add_client_with_special_names PASSED
tests/test_phase2_client_management.py::TestViewClientsReal::test_view_clients_commands FAILED
tests/test_phase2_client_management.py::TestCustomPricingReal::test_set_custom_pricing_variations PASSED
tests/test_phase2_client_management.py::TestCustomPricingReal::test_check_client_pricing FAILED
tests/test_phase2_client_management.py::TestClientManagementEdgeCases::test_add_client_with_duplicate_phone FAILED
tests/test_phase2_client_management.py::TestClientManagementEdgeCases::test_invalid_phone_numbers PASSED
tests/test_phase2_client_management.py::TestClientManagementEdgeCases::test_set_negative_pricing PASSED
tests/test_phase2_client_management.py::TestClientManagementEdgeCases::test_client_not_found FAILED
tests/test_phase3_scheduling.py::TestViewScheduleReal::test_view_schedule_commands FAILED
tests/test_phase3_scheduling.py::TestBookSessionsReal::test_book_session_natural_language PASSED
tests/test_phase3_scheduling.py::TestBookSessionsReal::test_booking_time_formats PASSED
tests/test_phase3_scheduling.py::TestBookSessionsReal::test_booking_date_parsing PASSED
tests/test_phase3_scheduling.py::TestCancelRescheduleReal::test_cancel_booking_variations PASSED
tests/test_phase3_scheduling.py::TestCancelRescheduleReal::test_reschedule_booking PASSED
tests/test_phase3_scheduling.py::TestBookingConflictsAndValidation::test_double_booking_prevention PASSED
tests/test_phase3_scheduling.py::TestBookingConflictsAndValidation::test_past_date_booking_prevention PASSED
tests/test_phase3_scheduling.py::TestBookingConflictsAndValidation::test_invalid_time_slots PASSED
tests/test_phases_4_11.py::TestPhase4_HabitTracking::test_setup_habits_for_clients ERROR
tests/test_phases_4_11.py::TestPhase4_HabitTracking::test_check_habit_compliance ERROR
tests/test_phases_4_11.py::TestPhase4_HabitTracking::test_send_habit_reminders ERROR
tests/test_phases_4_11.py::TestPhase5_WorkoutsAssessments::test_send_workouts ERROR
tests/test_phases_4_11.py::TestPhase5_WorkoutsAssessments::test_start_assessment ERROR
tests/test_phases_4_11.py::TestPhase5_WorkoutsAssessments::test_view_assessment_results ERROR
tests/test_phases_4_11.py::TestPhase6_PaymentsRevenue::test_request_payment ERROR
tests/test_phases_4_11.py::TestPhase6_PaymentsRevenue::test_check_revenue ERROR
tests/test_phases_4_11.py::TestPhase6_PaymentsRevenue::test_payment_confirmation ERROR
tests/test_phases_4_11.py::TestPhase7_AnalyticsReports::test_view_dashboard ERROR
tests/test_phases_4_11.py::TestPhase7_AnalyticsReports::test_client_analytics ERROR
tests/test_phases_4_11.py::TestPhase8_ClientFeatures::test_client_booking ERROR
tests/test_phases_4_11.py::TestPhase8_ClientFeatures::test_client_habit_logging ERROR
tests/test_phases_4_11.py::TestPhase8_ClientFeatures::test_client_progress ERROR
tests/test_phases_4_11.py::TestPhase9_Challenges::test_view_challenges ERROR
tests/test_phases_4_11.py::TestPhase9_Challenges::test_join_leave_challenges ERROR
tests/test_phases_4_11.py::TestPhase9_Challenges::test_leaderboard ERROR
tests/test_phases_4_11.py::TestPhase10_AdvancedFeatures::test_bulk_operations ERROR
tests/test_phases_4_11.py::TestPhase10_AdvancedFeatures::test_natural_language ERROR
tests/test_phases_4_11.py::TestPhase10_AdvancedFeatures::test_error_handling ERROR
tests/test_phases_4_11.py::TestPhase11_AutomatedFeatures::test_check_scheduled_reminders ERROR
tests/test_phases_4_11.py::TestPhase11_AutomatedFeatures::test_subscription_monitoring ERROR
tests/test_refiloe_complete.py::TestPhase1_UserRegistration::test_new_trainer_onboarding PASSED
tests/test_refiloe_complete.py::TestPhase1_UserRegistration::test_trainer_recognition PASSED
tests/test_refiloe_complete.py::TestPhase2_ClientManagement::test_add_client_variations PASSED
tests/test_refiloe_complete.py::TestPhase2_ClientManagement::test_view_clients PASSED
tests/test_refiloe_complete.py::TestPhase2_ClientManagement::test_set_custom_pricing PASSED
tests/test_refiloe_complete.py::TestPhase3_SchedulingBookings::test_view_schedule PASSED
tests/test_refiloe_complete.py::TestPhase3_SchedulingBookings::test_book_sessions PASSED
tests/test_refiloe_complete.py::TestPhase3_SchedulingBookings::test_cancel_reschedule FAILED
tests/test_refiloe_complete.py::TestPhase4_HabitTracking::test_setup_habits PASSED
tests/test_refiloe_complete.py::TestPhase5_WorkoutsAssessments::test_send_workouts PASSED
tests/test_refiloe_complete.py::TestPhase6_PaymentsRevenue::test_request_payment FAILED
tests/test_refiloe_complete.py::TestPhase6_PaymentsRevenue::test_check_revenue PASSED
tests/test_refiloe_complete.py::TestPhase8_ClientFeatures::test_client_booking PASSED
tests/test_refiloe_complete.py::TestPhase8_ClientFeatures::test_client_habit_logging PASSED
tests/test_refiloe_complete.py::TestPhase10_AdvancedFeatures::test_natural_language_understanding PASSED
tests/test_refiloe_complete.py::TestPhase10_AdvancedFeatures::test_error_handling FAILED
tests/test_refiloe_complete.py::TestCriticalBugs::test_trainer_registration_step_7_currency_parsing PASSED
tests/test_refiloe_complete.py::TestCriticalBugs::test_ai_responds_naturally_not_rigid_commands PASSED

==================================== ERRORS ====================================
__ ERROR at setup of TestPhase1_Registration.test_complete_trainer_onboarding __
tests/test_e2e_complete.py:91: in setup_method
    self.tester = RefiloeE2ETester()
tests/test_e2e_complete.py:32: in __init__
    self.process_message = RefiloeService().handle_message
E   TypeError: RefiloeService.__init__() missing 1 required positional argument: 'supabase_client'
_ ERROR at setup of TestPhase1_Registration.test_trainer_recognition_after_registration _
tests/test_e2e_complete.py:91: in setup_method
    self.tester = RefiloeE2ETester()
tests/test_e2e_complete.py:32: in __init__
    self.process_message = RefiloeService().handle_message
E   TypeError: RefiloeService.__init__() missing 1 required positional argument: 'supabase_client'
___ ERROR at setup of TestPhase2_ClientManagement.test_add_client_variations ___
tests/test_e2e_complete.py:166: in setup_method
    self.tester = RefiloeE2ETester()
tests/test_e2e_complete.py:32: in __init__
    self.process_message = RefiloeService().handle_message
E   TypeError: RefiloeService.__init__() missing 1 required positional argument: 'supabase_client'
_______ ERROR at setup of TestPhase2_ClientManagement.test_view_clients ________
tests/test_e2e_complete.py:166: in setup_method
    self.tester = RefiloeE2ETester()
tests/test_e2e_complete.py:32: in __init__
    self.process_message = RefiloeService().handle_message
E   TypeError: RefiloeService.__init__() missing 1 required positional argument: 'supabase_client'
______ ERROR at setup of TestPhase2_ClientManagement.test_custom_pricing _______
tests/test_e2e_complete.py:166: in setup_method
    self.tester = RefiloeE2ETester()
tests/test_e2e_complete.py:32: in __init__
    self.process_message = RefiloeService().handle_message
E   TypeError: RefiloeService.__init__() missing 1 required positional argument: 'supabase_client'
__________ ERROR at setup of TestPhase3_Scheduling.test_view_schedule __________
tests/test_e2e_complete.py:247: in setup_method
    self.tester = RefiloeE2ETester()
tests/test_e2e_complete.py:32: in __init__
    self.process_message = RefiloeService().handle_message
E   TypeError: RefiloeService.__init__() missing 1 required positional argument: 'supabase_client'
__________ ERROR at setup of TestPhase3_Scheduling.test_book_sessions __________
tests/test_e2e_complete.py:247: in setup_method
    self.tester = RefiloeE2ETester()
tests/test_e2e_complete.py:32: in __init__
    self.process_message = RefiloeService().handle_message
E   TypeError: RefiloeService.__init__() missing 1 required positional argument: 'supabase_client'
________ ERROR at setup of TestPhase3_Scheduling.test_cancel_reschedule ________
tests/test_e2e_complete.py:247: in setup_method
    self.tester = RefiloeE2ETester()
tests/test_e2e_complete.py:32: in __init__
    self.process_message = RefiloeService().handle_message
E   TypeError: RefiloeService.__init__() missing 1 required positional argument: 'supabase_client'
___ ERROR at setup of TestPhase4_HabitTracking.test_setup_habits_for_clients ___
tests/test_phases_4_11.py:143: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
____ ERROR at setup of TestPhase4_HabitTracking.test_check_habit_compliance ____
tests/test_phases_4_11.py:143: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
_____ ERROR at setup of TestPhase4_HabitTracking.test_send_habit_reminders _____
tests/test_phases_4_11.py:143: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
_____ ERROR at setup of TestPhase5_WorkoutsAssessments.test_send_workouts ______
tests/test_phases_4_11.py:209: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
____ ERROR at setup of TestPhase5_WorkoutsAssessments.test_start_assessment ____
tests/test_phases_4_11.py:209: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
_ ERROR at setup of TestPhase5_WorkoutsAssessments.test_view_assessment_results _
tests/test_phases_4_11.py:209: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
______ ERROR at setup of TestPhase6_PaymentsRevenue.test_request_payment _______
tests/test_phases_4_11.py:268: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
_______ ERROR at setup of TestPhase6_PaymentsRevenue.test_check_revenue ________
tests/test_phases_4_11.py:268: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
____ ERROR at setup of TestPhase6_PaymentsRevenue.test_payment_confirmation ____
tests/test_phases_4_11.py:268: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
______ ERROR at setup of TestPhase7_AnalyticsReports.test_view_dashboard _______
tests/test_phases_4_11.py:328: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
_____ ERROR at setup of TestPhase7_AnalyticsReports.test_client_analytics ______
tests/test_phases_4_11.py:328: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
_______ ERROR at setup of TestPhase8_ClientFeatures.test_client_booking ________
tests/test_phases_4_11.py:371: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
____ ERROR at setup of TestPhase8_ClientFeatures.test_client_habit_logging _____
tests/test_phases_4_11.py:371: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
_______ ERROR at setup of TestPhase8_ClientFeatures.test_client_progress _______
tests/test_phases_4_11.py:371: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
_________ ERROR at setup of TestPhase9_Challenges.test_view_challenges _________
tests/test_phases_4_11.py:434: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
______ ERROR at setup of TestPhase9_Challenges.test_join_leave_challenges ______
tests/test_phases_4_11.py:434: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
___________ ERROR at setup of TestPhase9_Challenges.test_leaderboard ___________
tests/test_phases_4_11.py:434: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
_____ ERROR at setup of TestPhase10_AdvancedFeatures.test_bulk_operations ______
tests/test_phases_4_11.py:494: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
_____ ERROR at setup of TestPhase10_AdvancedFeatures.test_natural_language _____
tests/test_phases_4_11.py:494: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
______ ERROR at setup of TestPhase10_AdvancedFeatures.test_error_handling ______
tests/test_phases_4_11.py:494: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
_ ERROR at setup of TestPhase11_AutomatedFeatures.test_check_scheduled_reminders _
tests/test_phases_4_11.py:553: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
_ ERROR at setup of TestPhase11_AutomatedFeatures.test_subscription_monitoring _
tests/test_phases_4_11.py:553: in setup_method
    self.tester = RefiloeE2ETesterExtended()
tests/test_phases_4_11.py:37: in __init__
    supabase_client = create_client(supabase_url, supabase_key)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:284: in create_client
    return Client(supabase_url=supabase_url, supabase_key=supabase_key, options=options)
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/supabase/client.py:59: in __init__
    raise SupabaseException("Invalid API key")
E   supabase.client.SupabaseException: Invalid API key
=================================== FAILURES ===================================
_________________ TestRealIntegration.test_booking_system_real _________________
tests/test_integration_real.py:182: in test_booking_system_real
    }).execute()
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/postgrest/_sync/request_builder.py:70: in execute
    raise APIError(r.json())
E   postgrest.exceptions.APIError: {'code': 'PGRST204', 'details': None, 'hint': None, 'message': "Could not find the 'booking_date' column of 'bookings' in the schema cache"}
___ TestTrainerRegistrationReal.test_trainer_recognition_after_registration ____
tests/test_phase1_registration.py:253: in test_trainer_recognition_after_registration
    assert 'john' in response.get('response', '').lower() or \
E   AssertionError: assert ('john' in <MagicMock name='AIIntentHandler().generate_smart_response().lower()' id='140018200045968'> or 'welcome' in <MagicMock name='AIIntentHandler().generate_smart_response().lower()' id='140018200045968'>)
E    +  where <MagicMock name='AIIntentHandler().generate_smart_response().lower()' id='140018200045968'> = <MagicMock name='AIIntentHandler().generate_smart_response().lower' id='140018446827024'>()
E    +    where <MagicMock name='AIIntentHandler().generate_smart_response().lower' id='140018446827024'> = <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'>.lower
E    +      where <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'> = <built-in method get of dict object at 0x7f5888616140>('response', '')
E    +        where <built-in method get of dict object at 0x7f5888616140> = {'response': <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'>, 'success': True}.get
E    +  and   <MagicMock name='AIIntentHandler().generate_smart_response().lower()' id='140018200045968'> = <MagicMock name='AIIntentHandler().generate_smart_response().lower' id='140018446827024'>()
E    +    where <MagicMock name='AIIntentHandler().generate_smart_response().lower' id='140018446827024'> = <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'>.lower
E    +      where <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'> = <built-in method get of dict object at 0x7f5888616140>('response', '')
E    +        where <built-in method get of dict object at 0x7f5888616140> = {'response': <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'>, 'success': True}.get
------------------------------ Captured log call -------------------------------
INFO     refiloe:logger.py:21 Background scheduler started
INFO     refiloe:logger.py:21 Routes setup complete
ERROR    refiloe:logger.py:25 Error sending WhatsApp message: Object of type MagicMock is not JSON serializable
__ TestClientRegistrationReal.test_client_receives_welcome_after_registration __
tests/test_phase1_registration.py:297: in test_client_receives_welcome_after_registration
    assert response.get('success') == True
E   assert False == True
E    +  where False = <built-in method get of dict object at 0x7f5887108d40>('success')
E    +    where <built-in method get of dict object at 0x7f5887108d40> = {'response': "Sorry, I'm having a bit of trouble right now. Please try again in a moment! ðŸ˜Š", 'success': False}.get
------------------------------ Captured log call -------------------------------
ERROR    refiloe:logger.py:25 Error getting user context: 'list' object has no attribute 'get'
ERROR    refiloe:logger.py:25 Error handling message: 'list' object has no attribute 'get'
________________ TestViewClientsReal.test_view_clients_commands ________________
tests/test_phase2_client_management.py:160: in test_view_clients_commands
    assert 'sarah' in message or 'john' in message or 'mike' in message or \
E   AssertionError: Failed to list clients with command: Show my clients
E   assert ('sarah' in '' or 'john' in '' or 'mike' in '' or 'client' in '')
------------------------------ Captured log call -------------------------------
ERROR    refiloe:logger.py:25 Error getting user context: Mock.keys() returned a non-iterable (type Mock)
ERROR    refiloe:logger.py:25 Error getting conversation history: 'Mock' object is not reversible
ERROR    refiloe:logger.py:25 Error sending WhatsApp message: Object of type MagicMock is not JSON serializable
_______________ TestCustomPricingReal.test_check_client_pricing ________________
tests/test_phase2_client_management.py:239: in test_check_client_pricing
    assert 'r' in message or 'rand' in message or \
E   AssertionError: Failed to show pricing with: What is Sarah's rate?
E   assert ('r' in '' or 'rand' in '' or False)
E    +  where False = any(<generator object TestCustomPricingReal.test_check_client_pricing.<locals>.<genexpr> at 0x7f5895e6bd80>)
------------------------------ Captured log call -------------------------------
ERROR    refiloe:logger.py:25 Error getting user context: object of type 'Mock' has no len()
ERROR    refiloe:logger.py:25 Error getting conversation history: 'Mock' object is not reversible
ERROR    refiloe:logger.py:25 Error sending WhatsApp message: Object of type MagicMock is not JSON serializable
______ TestClientManagementEdgeCases.test_add_client_with_duplicate_phone ______
tests/test_phase2_client_management.py:268: in test_add_client_with_duplicate_phone
    assert 'already' in response.get('message', '').lower() or \
E   AssertionError: assert ('already' in '' or 'exists' in '')
E    +  where '' = <built-in method lower of str object at 0x7f5899d3fba0>()
E    +    where <built-in method lower of str object at 0x7f5899d3fba0> = ''.lower
E    +      where '' = <built-in method get of dict object at 0x7f5885e9bfc0>('message', '')
E    +        where <built-in method get of dict object at 0x7f5885e9bfc0> = {'response': <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'>, 'success': True}.get
E    +  and   '' = <built-in method lower of str object at 0x7f5899d3fba0>()
E    +    where <built-in method lower of str object at 0x7f5899d3fba0> = ''.lower
E    +      where '' = <built-in method get of dict object at 0x7f5885e9bfc0>('message', '')
E    +        where <built-in method get of dict object at 0x7f5885e9bfc0> = {'response': <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'>, 'success': True}.get
------------------------------ Captured log call -------------------------------
ERROR    refiloe:logger.py:25 Error getting user context: object of type 'Mock' has no len()
ERROR    refiloe:logger.py:25 Error getting conversation history: 'Mock' object is not reversible
ERROR    refiloe:logger.py:25 Error sending WhatsApp message: Object of type MagicMock is not JSON serializable
_____________ TestClientManagementEdgeCases.test_client_not_found ______________
tests/test_phase2_client_management.py:311: in test_client_not_found
    assert 'not found' in response.get('message', '').lower() or \
E   assert ('not found' in '' or "doesn't exist" in '' or 'no client' in '')
E    +  where '' = <built-in method lower of str object at 0x7f5899d3fba0>()
E    +    where <built-in method lower of str object at 0x7f5899d3fba0> = ''.lower
E    +      where '' = <built-in method get of dict object at 0x7f588605acc0>('message', '')
E    +        where <built-in method get of dict object at 0x7f588605acc0> = {'response': <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'>, 'success': True}.get
E    +  and   '' = <built-in method lower of str object at 0x7f5899d3fba0>()
E    +    where <built-in method lower of str object at 0x7f5899d3fba0> = ''.lower
E    +      where '' = <built-in method get of dict object at 0x7f588605acc0>('message', '')
E    +        where <built-in method get of dict object at 0x7f588605acc0> = {'response': <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'>, 'success': True}.get
E    +  and   '' = <built-in method lower of str object at 0x7f5899d3fba0>()
E    +    where <built-in method lower of str object at 0x7f5899d3fba0> = ''.lower
E    +      where '' = <built-in method get of dict object at 0x7f588605acc0>('message', '')
E    +        where <built-in method get of dict object at 0x7f588605acc0> = {'response': <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'>, 'success': True}.get
------------------------------ Captured log call -------------------------------
ERROR    refiloe:logger.py:25 Error getting conversation history: 'Mock' object is not reversible
ERROR    refiloe:logger.py:25 Error creating conversation state: 'Mock' object is not subscriptable
ERROR    refiloe:logger.py:25 Error sending WhatsApp message: Object of type MagicMock is not JSON serializable
_______________ TestViewScheduleReal.test_view_schedule_commands _______________
tests/test_phase3_scheduling.py:74: in test_view_schedule_commands
    assert 'schedule' in message or 'booking' in message or \
E   AssertionError: Failed to show schedule with: Show my schedule
E   assert ('schedule' in '' or 'booking' in '' or 'session' in '' or 'appointment' in '' or 'no bookings' in '' or 'free' in '')
------------------------------ Captured log call -------------------------------
ERROR    refiloe:logger.py:25 Error getting user context: Mock.keys() returned a non-iterable (type Mock)
ERROR    refiloe:logger.py:25 Error getting conversation history: 'Mock' object is not reversible
ERROR    refiloe:logger.py:25 Error sending WhatsApp message: Object of type MagicMock is not JSON serializable
_____________ TestPhase3_SchedulingBookings.test_cancel_reschedule _____________
tests/test_refiloe_complete.py:329: in test_cancel_reschedule
    assert "reschedul" in response['message'].lower() or "moved" in response['message'].lower()
E   assert ('reschedul' in "today's schedule:\n9:00 am - sarah johnson\n2:00 pm - john doe" or 'moved' in "today's schedule:\n9:00 am - sarah johnson\n2:00 pm - john doe")
E    +  where "today's schedule:\n9:00 am - sarah johnson\n2:00 pm - john doe" = <built-in method lower of str object at 0x7f58963814c0>()
E    +    where <built-in method lower of str object at 0x7f58963814c0> = "Today's schedule:\n9:00 AM - Sarah Johnson\n2:00 PM - John Doe".lower
E    +  and   "today's schedule:\n9:00 am - sarah johnson\n2:00 pm - john doe" = <built-in method lower of str object at 0x7f58963814c0>()
E    +    where <built-in method lower of str object at 0x7f58963814c0> = "Today's schedule:\n9:00 AM - Sarah Johnson\n2:00 PM - John Doe".lower
_______________ TestPhase6_PaymentsRevenue.test_request_payment ________________
tests/test_refiloe_complete.py:368: in test_request_payment
    assert "payment" in response['message'].lower() or "invoice" in response['message'].lower()
E   assert ('payment' in "welcome to refiloe! i'm here to help you manage your personal training business. are you a trainer or a client?" or 'invoice' in "welcome to refiloe! i'm here to help you manage your personal training business. are you a trainer or a client?")
E    +  where "welcome to refiloe! i'm here to help you manage your personal training business. are you a trainer or a client?" = <built-in method lower of str object at 0x7f58963daab0>()
E    +    where <built-in method lower of str object at 0x7f58963daab0> = "Welcome to Refiloe! I'm here to help you manage your personal training business. Are you a trainer or a client?".lower
E    +  and   "welcome to refiloe! i'm here to help you manage your personal training business. are you a trainer or a client?" = <built-in method lower of str object at 0x7f58963daab0>()
E    +    where <built-in method lower of str object at 0x7f58963daab0> = "Welcome to Refiloe! I'm here to help you manage your personal training business. Are you a trainer or a client?".lower
_______________ TestPhase10_AdvancedFeatures.test_error_handling _______________
tests/test_refiloe_complete.py:424: in test_error_handling
    assert any(word in response['message'].lower() for word in ["past", "future", "cannot"])
E   assert False
E    +  where False = any(<generator object TestPhase10_AdvancedFeatures.test_error_handling.<locals>.<genexpr> at 0x7f58870b9e00>)
=============================== warnings summary ===============================
../../../../../opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/gotrue/types.py:679: 19 warnings
  /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/gotrue/types.py:679: PydanticDeprecatedSince20: The `update_forward_refs` method is deprecated; use `model_rebuild` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    model.update_forward_refs()

tests/test_phase1_registration.py::TestTrainerRegistrationReal::test_trainer_recognition_after_registration
  /home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/services/analytics.py:7: DeprecationWarning: 
  Pyarrow will become a required dependency of pandas in the next major release of pandas (pandas 3.0),
  (to allow more performant data types, such as the Arrow string type, and better interoperability with other libraries)
  but was not found to be installed on your system.
  If this would cause problems for you,
  please provide us feedback at https://github.com/pandas-dev/pandas/issues/54466
          
    import pandas as pd

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
--------------------------------- JSON report ----------------------------------
report saved to: test-results.json
- Generated html report: file:///home/runner/work/whatsapp-ai-assistant/whatsapp-ai-assistant/test-report.html -
=========================== short test summary info ============================
FAILED tests/test_integration_real.py::TestRealIntegration::test_booking_system_real - postgrest.exceptions.APIError: {'code': 'PGRST204', 'details': None, 'hint': None, 'message': "Could not find the 'booking_date' column of 'bookings' in the schema cache"}
FAILED tests/test_phase1_registration.py::TestTrainerRegistrationReal::test_trainer_recognition_after_registration - AssertionError: assert ('john' in <MagicMock name='AIIntentHandler().generate_smart_response().lower()' id='140018200045968'> or 'welcome' in <MagicMock name='AIIntentHandler().generate_smart_response().lower()' id='140018200045968'>)
 +  where <MagicMock name='AIIntentHandler().generate_smart_response().lower()' id='140018200045968'> = <MagicMock name='AIIntentHandler().generate_smart_response().lower' id='140018446827024'>()
 +    where <MagicMock name='AIIntentHandler().generate_smart_response().lower' id='140018446827024'> = <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'>.lower
 +      where <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'> = <built-in method get of dict object at 0x7f5888616140>('response', '')
 +        where <built-in method get of dict object at 0x7f5888616140> = {'response': <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'>, 'success': True}.get
 +  and   <MagicMock name='AIIntentHandler().generate_smart_response().lower()' id='140018200045968'> = <MagicMock name='AIIntentHandler().generate_smart_response().lower' id='140018446827024'>()
 +    where <MagicMock name='AIIntentHandler().generate_smart_response().lower' id='140018446827024'> = <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'>.lower
 +      where <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'> = <built-in method get of dict object at 0x7f5888616140>('response', '')
 +        where <built-in method get of dict object at 0x7f5888616140> = {'response': <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'>, 'success': True}.get
FAILED tests/test_phase1_registration.py::TestClientRegistrationReal::test_client_receives_welcome_after_registration - assert False == True
 +  where False = <built-in method get of dict object at 0x7f5887108d40>('success')
 +    where <built-in method get of dict object at 0x7f5887108d40> = {'response': "Sorry, I'm having a bit of trouble right now. Please try again in a moment! ðŸ˜Š", 'success': False}.get
FAILED tests/test_phase2_client_management.py::TestViewClientsReal::test_view_clients_commands - AssertionError: Failed to list clients with command: Show my clients
assert ('sarah' in '' or 'john' in '' or 'mike' in '' or 'client' in '')
FAILED tests/test_phase2_client_management.py::TestCustomPricingReal::test_check_client_pricing - AssertionError: Failed to show pricing with: What is Sarah's rate?
assert ('r' in '' or 'rand' in '' or False)
 +  where False = any(<generator object TestCustomPricingReal.test_check_client_pricing.<locals>.<genexpr> at 0x7f5895e6bd80>)
FAILED tests/test_phase2_client_management.py::TestClientManagementEdgeCases::test_add_client_with_duplicate_phone - AssertionError: assert ('already' in '' or 'exists' in '')
 +  where '' = <built-in method lower of str object at 0x7f5899d3fba0>()
 +    where <built-in method lower of str object at 0x7f5899d3fba0> = ''.lower
 +      where '' = <built-in method get of dict object at 0x7f5885e9bfc0>('message', '')
 +        where <built-in method get of dict object at 0x7f5885e9bfc0> = {'response': <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'>, 'success': True}.get
 +  and   '' = <built-in method lower of str object at 0x7f5899d3fba0>()
 +    where <built-in method lower of str object at 0x7f5899d3fba0> = ''.lower
 +      where '' = <built-in method get of dict object at 0x7f5885e9bfc0>('message', '')
 +        where <built-in method get of dict object at 0x7f5885e9bfc0> = {'response': <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'>, 'success': True}.get
FAILED tests/test_phase2_client_management.py::TestClientManagementEdgeCases::test_client_not_found - assert ('not found' in '' or "doesn't exist" in '' or 'no client' in '')
 +  where '' = <built-in method lower of str object at 0x7f5899d3fba0>()
 +    where <built-in method lower of str object at 0x7f5899d3fba0> = ''.lower
 +      where '' = <built-in method get of dict object at 0x7f588605acc0>('message', '')
 +        where <built-in method get of dict object at 0x7f588605acc0> = {'response': <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'>, 'success': True}.get
 +  and   '' = <built-in method lower of str object at 0x7f5899d3fba0>()
 +    where <built-in method lower of str object at 0x7f5899d3fba0> = ''.lower
 +      where '' = <built-in method get of dict object at 0x7f588605acc0>('message', '')
 +        where <built-in method get of dict object at 0x7f588605acc0> = {'response': <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'>, 'success': True}.get
 +  and   '' = <built-in method lower of str object at 0x7f5899d3fba0>()
 +    where <built-in method lower of str object at 0x7f5899d3fba0> = ''.lower
 +      where '' = <built-in method get of dict object at 0x7f588605acc0>('message', '')
 +        where <built-in method get of dict object at 0x7f588605acc0> = {'response': <MagicMock name='AIIntentHandler().generate_smart_response()' id='140018181648016'>, 'success': True}.get
FAILED tests/test_phase3_scheduling.py::TestViewScheduleReal::test_view_schedule_commands - AssertionError: Failed to show schedule with: Show my schedule
assert ('schedule' in '' or 'booking' in '' or 'session' in '' or 'appointment' in '' or 'no bookings' in '' or 'free' in '')
FAILED tests/test_refiloe_complete.py::TestPhase3_SchedulingBookings::test_cancel_reschedule - assert ('reschedul' in "today's schedule:\n9:00 am - sarah johnson\n2:00 pm - john doe" or 'moved' in "today's schedule:\n9:00 am - sarah johnson\n2:00 pm - john doe")
 +  where "today's schedule:\n9:00 am - sarah johnson\n2:00 pm - john doe" = <built-in method lower of str object at 0x7f58963814c0>()
 +    where <built-in method lower of str object at 0x7f58963814c0> = "Today's schedule:\n9:00 AM - Sarah Johnson\n2:00 PM - John Doe".lower
 +  and   "today's schedule:\n9:00 am - sarah johnson\n2:00 pm - john doe" = <built-in method lower of str object at 0x7f58963814c0>()
 +    where <built-in method lower of str object at 0x7f58963814c0> = "Today's schedule:\n9:00 AM - Sarah Johnson\n2:00 PM - John Doe".lower
FAILED tests/test_refiloe_complete.py::TestPhase6_PaymentsRevenue::test_request_payment - assert ('payment' in "welcome to refiloe! i'm here to help you manage your personal training business. are you a trainer or a client?" or 'invoice' in "welcome to refiloe! i'm here to help you manage your personal training business. are you a trainer or a client?")
 +  where "welcome to refiloe! i'm here to help you manage your personal training business. are you a trainer or a client?" = <built-in method lower of str object at 0x7f58963daab0>()
 +    where <built-in method lower of str object at 0x7f58963daab0> = "Welcome to Refiloe! I'm here to help you manage your personal training business. Are you a trainer or a client?".lower
 +  and   "welcome to refiloe! i'm here to help you manage your personal training business. are you a trainer or a client?" = <built-in method lower of str object at 0x7f58963daab0>()
 +    where <built-in method lower of str object at 0x7f58963daab0> = "Welcome to Refiloe! I'm here to help you manage your personal training business. Are you a trainer or a client?".lower
FAILED tests/test_refiloe_complete.py::TestPhase10_AdvancedFeatures::test_error_handling - assert False
 +  where False = any(<generator object TestPhase10_AdvancedFeatures.test_error_handling.<locals>.<genexpr> at 0x7f58870b9e00>)
ERROR tests/test_e2e_complete.py::TestPhase1_Registration::test_complete_trainer_onboarding - TypeError: RefiloeService.__init__() missing 1 required positional argument: 'supabase_client'
ERROR tests/test_e2e_complete.py::TestPhase1_Registration::test_trainer_recognition_after_registration - TypeError: RefiloeService.__init__() missing 1 required positional argument: 'supabase_client'
ERROR tests/test_e2e_complete.py::TestPhase2_ClientManagement::test_add_client_variations - TypeError: RefiloeService.__init__() missing 1 required positional argument: 'supabase_client'
ERROR tests/test_e2e_complete.py::TestPhase2_ClientManagement::test_view_clients - TypeError: RefiloeService.__init__() missing 1 required positional argument: 'supabase_client'
ERROR tests/test_e2e_complete.py::TestPhase2_ClientManagement::test_custom_pricing - TypeError: RefiloeService.__init__() missing 1 required positional argument: 'supabase_client'
ERROR tests/test_e2e_complete.py::TestPhase3_Scheduling::test_view_schedule - TypeError: RefiloeService.__init__() missing 1 required positional argument: 'supabase_client'
ERROR tests/test_e2e_complete.py::TestPhase3_Scheduling::test_book_sessions - TypeError: RefiloeService.__init__() missing 1 required positional argument: 'supabase_client'
ERROR tests/test_e2e_complete.py::TestPhase3_Scheduling::test_cancel_reschedule - TypeError: RefiloeService.__init__() missing 1 required positional argument: 'supabase_client'
ERROR tests/test_phases_4_11.py::TestPhase4_HabitTracking::test_setup_habits_for_clients - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase4_HabitTracking::test_check_habit_compliance - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase4_HabitTracking::test_send_habit_reminders - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase5_WorkoutsAssessments::test_send_workouts - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase5_WorkoutsAssessments::test_start_assessment - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase5_WorkoutsAssessments::test_view_assessment_results - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase6_PaymentsRevenue::test_request_payment - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase6_PaymentsRevenue::test_check_revenue - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase6_PaymentsRevenue::test_payment_confirmation - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase7_AnalyticsReports::test_view_dashboard - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase7_AnalyticsReports::test_client_analytics - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase8_ClientFeatures::test_client_booking - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase8_ClientFeatures::test_client_habit_logging - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase8_ClientFeatures::test_client_progress - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase9_Challenges::test_view_challenges - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase9_Challenges::test_join_leave_challenges - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase9_Challenges::test_leaderboard - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase10_AdvancedFeatures::test_bulk_operations - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase10_AdvancedFeatures::test_natural_language - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase10_AdvancedFeatures::test_error_handling - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase11_AutomatedFeatures::test_check_scheduled_reminders - supabase.client.SupabaseException: Invalid API key
ERROR tests/test_phases_4_11.py::TestPhase11_AutomatedFeatures::test_subscription_monitoring - supabase.client.SupabaseException: Invalid API key
= 11 failed, 49 passed, 1 skipped, 20 warnings, 30 errors in 74.56s (0:01:14) ==
