<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness Assessment - {{ client_name }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .progress-bar {
            transition: width 0.3s ease;
        }
        
        /* Mobile-friendly styles */
        @media (max-width: 640px) {
            .mobile-button {
                font-size: 16px;
                padding: 12px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div x-data="assessmentForm()" class="min-h-screen">
        
        <!-- Progress Bar -->
        <div class="sticky top-0 bg-white shadow-sm z-40">
            <div class="h-2 bg-gray-200">
                <div class="progress-bar h-full bg-purple-600" 
                     :style="`width: ${progress}%`"></div>
            </div>
            <div class="px-4 py-3 flex justify-between items-center">
                <h1 class="text-lg font-semibold">Fitness Assessment</h1>
                <span class="text-sm text-gray-600" x-text="`${currentSection + 1} of ${totalSections}`"></span>
            </div>
        </div>

        <!-- Form Content -->
        <div class="max-w-2xl mx-auto p-4">
            
            <!-- Welcome Section -->
            <div x-show="currentSection === 0" x-transition>
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h2 class="text-2xl font-bold mb-4">Welcome, {{ client_name }}! ðŸ‘‹</h2>
                    <p class="text-gray-600 mb-6">
                        This fitness assessment will help your trainer create the perfect program for you.
                        It should take about 10-15 minutes to complete.
                    </p>
                    
                    <div class="space-y-3 mb-6">
                        <div class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                            <span>Your information is kept private and secure</span>
                        </div>
                        <div class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                            <span>You can save and continue later</span>
                        </div>
                        <div class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                            <span>Be honest - this helps create the best program for you</span>
                        </div>
                    </div>
                    
                    <button @click="nextSection()" 
                            class="w-full bg-purple-600 text-white py-3 rounded-lg font-medium mobile-button">
                        Let's Get Started! ðŸš€
                    </button>
                </div>
            </div>

            <!-- Health Section -->
            <div x-show="currentSection === 1" x-transition>
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h2 class="text-xl font-bold mb-4">
                        <i class="fas fa-heart-pulse mr-2"></i>
                        Health & Medical History
                    </h2>
                    
                    <div class="space-y-6">
                        <!-- Injuries Question -->
                        <div x-show="template.health.injuries">
                            <label class="block text-sm font-medium mb-2">
                                Do you have any current injuries or areas of pain?
                            </label>
                            <div class="space-y-2">
                                <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="has_injuries" value="no" 
                                           x-model="formData.health.has_injuries" class="mr-3">
                                    <span>No injuries or pain</span>
                                </label>
                                <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="has_injuries" value="yes" 
                                           x-model="formData.health.has_injuries" class="mr-3">
                                    <span>Yes, I have injuries/pain</span>
                                </label>
                            </div>
                            
                            <div x-show="formData.health.has_injuries === 'yes'" x-transition class="mt-3">
                                <textarea x-model="formData.health.pain_areas"
                                          placeholder="Please describe your injuries or pain areas..."
                                          class="w-full p-3 border rounded-lg" rows="3"></textarea>
                            </div>
                        </div>

                        <!-- Medications -->
                        <div x-show="template.health.medications">
                            <label class="block text-sm font-medium mb-2">
                                Are you currently taking any medications?
                            </label>
                            <input type="text" x-model="formData.health.medications"
                                   placeholder="List medications or type 'None'"
                                   class="w-full p-3 border rounded-lg">
                        </div>

                        <!-- Chronic Conditions -->
                        <div x-show="template.health.conditions">
                            <label class="block text-sm font-medium mb-2">
                                Do you have any chronic health conditions?
                            </label>
                            <input type="text" x-model="formData.health.conditions"
                                   placeholder="e.g., diabetes, high blood pressure, or 'None'"
                                   class="w-full p-3 border rounded-lg">
                        </div>

                        <!-- Doctor Clearance -->
                        <div x-show="template.health.clearance">
                            <label class="block text-sm font-medium mb-2">
                                Has your doctor cleared you for exercise?
                            </label>
                            <select x-model="formData.health.doctor_clearance"
                                    class="w-full p-3 border rounded-lg">
                                <option value="">Select...</option>
                                <option value="yes">Yes, cleared for all exercise</option>
                                <option value="with_restrictions">Yes, with some restrictions</option>
                                <option value="no">No / Not sure</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lifestyle Section -->
            <div x-show="currentSection === 2" x-transition>
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h2 class="text-xl font-bold mb-4">
                        <i class="fas fa-person-walking mr-2"></i>
                        Lifestyle & Habits
                    </h2>
                    
                    <div class="space-y-6">
                        <!-- Activity Level -->
                        <div x-show="template.lifestyle.activity">
                            <label class="block text-sm font-medium mb-2">
                                How would you describe your daily activity level?
                            </label>
                            <select x-model="formData.lifestyle.activity_level"
                                    class="w-full p-3 border rounded-lg">
                                <option value="">Select...</option>
                                <option value="sedentary">Sedentary (mostly sitting)</option>
                                <option value="light">Lightly active (some walking)</option>
                                <option value="moderate">Moderately active (on feet often)</option>
                                <option value="active">Very active (physical job)</option>
                            </select>
                        </div>

                        <!-- Sleep -->
                        <div x-show="template.lifestyle.sleep">
                            <label class="block text-sm font-medium mb-2">
                                How many hours of sleep do you get per night?
                            </label>
                            <input type="number" x-model="formData.lifestyle.sleep_hours"
                                   min="3" max="12" step="0.5"
                                   class="w-full p-3 border rounded-lg"
                                   placeholder="e.g., 7.5">
                        </div>

                        <!-- Stress -->
                        <div x-show="template.lifestyle.stress">
                            <label class="block text-sm font-medium mb-2">
                                Rate your stress level (1-10)
                            </label>
                            <input type="range" x-model="formData.lifestyle.stress_level"
                                   min="1" max="10" class="w-full">
                            <div class="flex justify-between text-xs text-gray-600">
                                <span>Low (1)</span>
                                <span class="text-lg font-bold text-purple-600" x-text="formData.lifestyle.stress_level || 5"></span>
                                <span>High (10)</span>
                            </div>
                        </div>

                        <!-- Water Intake -->
                        <div x-show="template.lifestyle.water">
                            <label class="block text-sm font-medium mb-2">
                                How many liters of water do you drink daily?
                            </label>
                            <input type="number" x-model="formData.lifestyle.water_intake"
                                   min="0" max="6" step="0.5"
                                   class="w-full p-3 border rounded-lg"
                                   placeholder="e.g., 2.5">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Goals Section -->
            <div x-show="currentSection === 3" x-transition>
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h2 class="text-xl font-bold mb-4">
                        <i class="fas fa-bullseye mr-2"></i>
                        Your Fitness Goals
                    </h2>
                    
                    <div class="space-y-6">
                        <!-- Primary Goal -->
                        <div x-show="template.goals.primary">
                            <label class="block text-sm font-medium mb-2">
                                What's your PRIMARY fitness goal?
                            </label>
                            <select x-model="formData.goals.primary_goal"
                                    class="w-full p-3 border rounded-lg">
                                <option value="">Select...</option>
                                <option value="weight_loss">Lose weight</option>
                                <option value="muscle_gain">Build muscle</option>
                                <option value="strength">Get stronger</option>
                                <option value="endurance">Improve endurance</option>
                                <option value="health">Better overall health</option>
                                <option value="sports">Sports performance</option>
                                <option value="rehabilitation">Rehabilitation</option>
                            </select>
                        </div>

                        <!-- Specific Targets -->
                        <div x-show="template.goals.specific">
                            <label class="block text-sm font-medium mb-2">
                                Do you have specific targets?
                            </label>
                            <textarea x-model="formData.goals.specific_targets"
                                      placeholder="e.g., 'Lose 10kg', 'Run 5km', 'Do 10 pull-ups'"
                                      class="w-full p-3 border rounded-lg" rows="3"></textarea>
                        </div>

                        <!-- Timeline -->
                        <div x-show="template.goals.timeline">
                            <label class="block text-sm font-medium mb-2">
                                In how many weeks would you like to achieve this?
                            </label>
                            <input type="number" x-model="formData.goals.timeline_weeks"
                                   min="4" max="52"
                                   class="w-full p-3 border rounded-lg"
                                   placeholder="e.g., 12">
                        </div>

                        <!-- Motivation -->
                        <div x-show="template.goals.motivation">
                            <label class="block text-sm font-medium mb-2">
                                Rate your motivation level (1-10)
                            </label>
                            <input type="range" x-model="formData.goals.motivation_level"
                                   min="1" max="10" class="w-full">
                            <div class="flex justify-between text-xs text-gray-600">
                                <span>Low (1)</span>
                                <span class="text-lg font-bold text-purple-600" x-text="formData.goals.motivation_level || 5"></span>
                                <span>High (10)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Measurements Section -->
            <div x-show="currentSection === 4" x-transition>
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h2 class="text-xl font-bold mb-4">
                        <i class="fas fa-ruler mr-2"></i>
                        Physical Measurements
                    </h2>
                    
                    <div class="space-y-6">
                        <!-- Weight -->
                        <div x-show="template.measurements.weight">
                            <label class="block text-sm font-medium mb-2">
                                Current weight (kg)
                            </label>
                            <input type="number" x-model="formData.measurements.weight_kg"
                                   min="30" max="300" step="0.1"
                                   class="w-full p-3 border rounded-lg"
                                   placeholder="e.g., 75.5">
                        </div>

                        <!-- Height -->
                        <div x-show="template.measurements.height">
                            <label class="block text-sm font-medium mb-2">
                                Height (cm)
                            </label>
                            <input type="number" x-model="formData.measurements.height_cm"
                                   min="100" max="250"
                                   class="w-full p-3 border rounded-lg"
                                   placeholder="e.g., 175">
                        </div>

                        <!-- Waist -->
                        <div x-show="template.measurements.waist">
                            <label class="block text-sm font-medium mb-2">
                                Waist circumference (cm) - Optional
                            </label>
                            <input type="number" x-model="formData.measurements.waist"
                                   min="40" max="200"
                                   class="w-full p-3 border rounded-lg"
                                   placeholder="Measure at belly button">
                        </div>

                        <!-- Other measurements -->
                        <div x-show="template.measurements.chest">
                            <label class="block text-sm font-medium mb-2">
                                Chest circumference (cm) - Optional
                            </label>
                            <input type="number" x-model="formData.measurements.chest"
                                   min="50" max="200"
                                   class="w-full p-3 border rounded-lg"
                                   placeholder="Measure at fullest part">
                        </div>

                        <div x-show="template.measurements.hips">
                            <label class="block text-sm font-medium mb-2">
                                Hip circumference (cm) - Optional
                            </label>
                            <input type="number" x-model="formData.measurements.hips"
                                   min="50" max="200"
                                   class="w-full p-3 border rounded-lg"
                                   placeholder="Measure at widest part">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fitness Tests Section -->
            <div x-show="currentSection === 5" x-transition>
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h2 class="text-xl font-bold mb-4">
                        <i class="fas fa-dumbbell mr-2"></i>
                        Fitness Tests
                    </h2>
                    <p class="text-sm text-gray-600 mb-4">
                        Do these simple tests to measure your current fitness level. Do your best but don't push too hard!
                    </p>
                    
                    <div class="space-y-6">
                        <!-- Push-ups -->
                        <div x-show="template.tests.pushups">
                            <label class="block text-sm font-medium mb-2">
                                How many push-ups can you do with good form?
                            </label>
                            <input type="number" x-model="formData.tests.push_ups_count"
                                   min="0" max="200"
                                   placeholder="Enter 0 if you can't do any yet"
                                   class="w-full p-3 border rounded-lg">
                            <p class="text-xs text-gray-500 mt-1">You can do them on your knees if needed</p>
                        </div>

                        <!-- Plank -->
                        <div x-show="template.tests.plank">
                            <label class="block text-sm font-medium mb-2">
                                How many seconds can you hold a plank?
                            </label>
                            <input type="number" x-model="formData.tests.plank_hold_seconds"
                                   min="0" max="600"
                                   placeholder="Time in seconds"
                                   class="w-full p-3 border rounded-lg">
                        </div>

                        <!-- Squats -->
                        <div x-show="template.tests.squats">
                            <label class="block text-sm font-medium mb-2">
                                How many bodyweight squats can you do?
                            </label>
                            <input type="number" x-model="formData.tests.squat_reps"
                                   min="0" max="200"
                                   placeholder="With good form"
                                   class="w-full p-3 border rounded-lg">
                        </div>

                        <!-- Cardio -->
                        <div x-show="template.tests.cardio">
                            <label class="block text-sm font-medium mb-2">
                                How do you feel after climbing 2 flights of stairs?
                            </label>
                            <select x-model="formData.tests.cardio_level"
                                    class="w-full p-3 border rounded-lg">
                                <option value="">Select...</option>
                                <option value="easy">Easy, no problem</option>
                                <option value="slightly_winded">Slightly winded</option>
                                <option value="need_rest">Need to catch my breath</option>
                                <option value="very_difficult">Very difficult</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Mobile-Optimized Photos Section -->
            <div x-show="currentSection === 6 && template.include_photos" x-transition>
                <div class="bg-white rounded-lg shadow-sm p-4 md:p-6">
                    <h2 class="text-xl font-bold mb-4">
                        <i class="fas fa-camera mr-2"></i>
                        Progress Photos (Optional)
                    </h2>
                    <p class="text-sm text-gray-600 mb-4">
                        Photos help track your visual progress. They're completely optional and kept private.
                    </p>
                    
                    <div class="space-y-4">
                        <!-- Photo upload areas optimized for mobile -->
                        <div class="grid grid-cols-1 gap-4">
                            
                            <!-- Front View -->
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                                <div class="flex items-center justify-between mb-3">
                                    <span class="font-medium">Front View</span>
                                    <span x-show="formData.photos.front && formData.photos.front.uploaded" class="text-green-600">
                                        <i class="fas fa-check-circle"></i> Uploaded
                                    </span>
                                </div>
                                
                                <!-- Preview if photo exists -->
                                <div x-show="formData.photos.front && formData.photos.front.preview" class="mb-3">
                                    <img :src="formData.photos.front.preview" 
                                         class="w-32 h-32 object-cover rounded mx-auto">
                                </div>
                                
                                <!-- Loading indicator -->
                                <div x-show="photoLoading.front" class="text-center py-4">
                                    <i class="fas fa-spinner fa-spin text-2xl text-purple-600"></i>
                                    <p class="text-sm text-gray-600 mt-2">Uploading photo...</p>
                                </div>
                                
                                <!-- Upload buttons -->
                                <div x-show="!photoLoading.front" class="flex gap-2">
                                    <label class="flex-1">
                                        <input type="file" 
                                               accept="image/*" 
                                               capture="environment"
                                               class="hidden"
                                               @change="uploadPhoto($event, 'front')">
                                        <div class="bg-purple-600 text-white text-center py-3 px-4 rounded-lg cursor-pointer hover:bg-purple-700 transition">
                                            <i class="fas fa-camera mr-2"></i>
                                            Take Photo
                                        </div>
                                    </label>
                                    
                                    <label class="flex-1">
                                        <input type="file" 
                                               accept="image/*"
                                               class="hidden"
                                               @change="uploadPhoto($event, 'front')">
                                        <div class="bg-gray-200 text-gray-700 text-center py-3 px-4 rounded-lg cursor-pointer hover:bg-gray-300 transition">
                                            <i class="fas fa-folder-open mr-2"></i>
                                            Choose File
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Side View -->
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                                <div class="flex items-center justify-between mb-3">
                                    <span class="font-medium">Side View</span>
                                    <span x-show="formData.photos.side && formData.photos.side.uploaded" class="text-green-600">
                                        <i class="fas fa-check-circle"></i> Uploaded
                                    </span>
                                </div>
                                
                                <!-- Preview if photo exists -->
                                <div x-show="formData.photos.side && formData.photos.side.preview" class="mb-3">
                                    <img :src="formData.photos.side.preview" 
                                         class="w-32 h-32 object-cover rounded mx-auto">
                                </div>
                                
                                <!-- Loading indicator -->
                                <div x-show="photoLoading.side" class="text-center py-4">
                                    <i class="fas fa-spinner fa-spin text-2xl text-purple-600"></i>
                                    <p class="text-sm text-gray-600 mt-2">Uploading photo...</p>
                                </div>
                                
                                <!-- Upload buttons -->
                                <div x-show="!photoLoading.side" class="flex gap-2">
                                    <label class="flex-1">
                                        <input type="file" 
                                               accept="image/*" 
                                               capture="environment"
                                               class="hidden"
                                               @change="uploadPhoto($event, 'side')">
                                        <div class="bg-purple-600 text-white text-center py-3 px-4 rounded-lg cursor-pointer hover:bg-purple-700 transition">
                                            <i class="fas fa-camera mr-2"></i>
                                            Take Photo
                                        </div>
                                    </label>
                                    
                                    <label class="flex-1">
                                        <input type="file" 
                                               accept="image/*"
                                               class="hidden"
                                               @change="uploadPhoto($event, 'side')">
                                        <div class="bg-gray-200 text-gray-700 text-center py-3 px-4 rounded-lg cursor-pointer hover:bg-gray-300 transition">
                                            <i class="fas fa-folder-open mr-2"></i>
                                            Choose File
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Back View -->
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                                <div class="flex items-center justify-between mb-3">
                                    <span class="font-medium">Back View</span>
                                    <span x-show="formData.photos.back && formData.photos.back.uploaded" class="text-green-600">
                                        <i class="fas fa-check-circle"></i> Uploaded
                                    </span>
                                </div>
                                
                                <!-- Preview if photo exists -->
                                <div x-show="formData.photos.back && formData.photos.back.preview" class="mb-3">
                                    <img :src="formData.photos.back.preview" 
                                         class="w-32 h-32 object-cover rounded mx-auto">
                                </div>
                                
                                <!-- Loading indicator -->
                                <div x-show="photoLoading.back" class="text-center py-4">
                                    <i class="fas fa-spinner fa-spin text-2xl text-purple-600"></i>
                                    <p class="text-sm text-gray-600 mt-2">Uploading photo...</p>
                                </div>
                                
                                <!-- Upload buttons -->
                                <div x-show="!photoLoading.back" class="flex gap-2">
                                    <label class="flex-1">
                                        <input type="file" 
                                               accept="image/*" 
                                               capture="environment"
                                               class="hidden"
                                               @change="uploadPhoto($event, 'back')">
                                        <div class="bg-purple-600 text-white text-center py-3 px-4 rounded-lg cursor-pointer hover:bg-purple-700 transition">
                                            <i class="fas fa-camera mr-2"></i>
                                            Take Photo
                                        </div>
                                    </label>
                                    
                                    <label class="flex-1">
                                        <input type="file" 
                                               accept="image/*"
                                               class="hidden"
                                               @change="uploadPhoto($event, 'back')">
                                        <div class="bg-gray-200 text-gray-700 text-center py-3 px-4 rounded-lg cursor-pointer hover:bg-gray-300 transition">
                                            <i class="fas fa-folder-open mr-2"></i>
                                            Choose File
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tips for good photos -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mt-4">
                            <p class="text-sm text-blue-800 font-medium mb-2">
                                <i class="fas fa-lightbulb mr-1"></i> Photo Tips:
                            </p>
                            <ul class="text-xs text-blue-700 space-y-1">
                                <li>â€¢ Stand against a plain background</li>
                                <li>â€¢ Wear fitted clothing to show progress</li>
                                <li>â€¢ Keep the same pose for consistency</li>
                                <li>â€¢ Use good lighting (natural light is best)</li>
                            </ul>
                        </div>
                        
                        <p class="text-xs text-gray-500 text-center">
                            <i class="fas fa-lock mr-1"></i>
                            Photos are encrypted and only visible to you and your trainer
                        </p>
                    </div>
                </div>
            </div>

            <!-- Review Section -->
            <div x-show="currentSection === 7" x-transition>
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h2 class="text-xl font-bold mb-4">
                        <i class="fas fa-check-circle mr-2"></i>
                        Review & Submit
                    </h2>
                    
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                        <p class="text-green-800 font-medium">
                            Great job completing your assessment! ðŸŽ‰
                        </p>
                        <p class="text-sm text-green-700 mt-1">
                            Your trainer will review this and create your personalized program.
                        </p>
                    </div>
                    
                    <!-- Summary of entered data -->
                    <div class="space-y-4 mb-6">
                        <div class="text-sm">
                            <span class="font-medium">Primary Goal:</span>
                            <span x-text="formData.goals.primary_goal ? formData.goals.primary_goal.replace('_', ' ') : 'Not specified'"></span>
                        </div>
                        <div class="text-sm">
                            <span class="font-medium">Current Weight:</span>
                            <span x-text="formData.measurements.weight_kg ? formData.measurements.weight_kg + 'kg' : 'Not specified'"></span>
                        </div>
                        <div class="text-sm">
                            <span class="font-medium">Fitness Level:</span>
                            <span x-text="`Push-ups: ${formData.tests.push_ups_count || 0}, Plank: ${formData.tests.plank_hold_seconds || 0}s`"></span>
                        </div>
                    </div>
                    
                    <button @click="submitAssessment()"
                            :disabled="isSubmitting"
                            class="w-full bg-green-600 text-white py-3 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed">
                        <span x-show="!isSubmitting">Submit Assessment âœ…</span>
                        <span x-show="isSubmitting">
                            <i class="fas fa-spinner fa-spin mr-2"></i>
                            Submitting...
                        </span>
                    </button>
                </div>
            </div>

            <!-- Success Section -->
            <div x-show="currentSection === 8" x-transition>
                <div class="bg-white rounded-lg shadow-sm p-6 text-center">
                    <div class="text-6xl mb-4">ðŸŽ‰</div>
                    <h2 class="text-2xl font-bold mb-4">Assessment Complete!</h2>
                    <p class="text-gray-600 mb-6">
                        Thank you for completing your fitness assessment. Your trainer will review your information and create a personalized program for you.
                    </p>
                    <p class="text-sm text-gray-500">
                        You can close this window now. Your trainer will be in touch soon!
                    </p>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="flex justify-between mt-6" x-show="currentSection > 0 && currentSection < 7">
                <button @click="previousSection()"
                        class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Back
                </button>
                
                <button @click="saveProgress()"
                        class="px-6 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 transition">
                    <i class="fas fa-save mr-2"></i>
                    Save
                </button>
                
                <button @click="nextSection()"
                        class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
                    Next
                    <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        function assessmentForm() {
            return {
                currentSection: 0,
                totalSections: 8,
                progress: 0,
                isSubmitting: false,
                photoLoading: {
                    front: false,
                    side: false,
                    back: false
                },
                
                // Template settings from backend (this would come from your server)
                template: {
                    health: {
                        injuries: true,
                        medications: true,
                        conditions: true,
                        clearance: true
                    },
                    lifestyle: {
                        activity: true,
                        sleep: true,
                        stress: true,
                        water: true
                    },
                    goals: {
                        primary: true,
                        specific: true,
                        timeline: true,
                        motivation: true
                    },
                    measurements: {
                        weight: true,
                        height: true,
                        waist: true,
                        chest: true,
                        hips: true
                    },
                    tests: {
                        pushups: true,
                        plank: true,
                        squats: true,
                        cardio: true
                    },
                    include_photos: true
                },
                
                // Form data
                formData: {
                    health: {},
                    lifestyle: {
                        stress_level: 5,
                        motivation_level: 5
                    },
                    goals: {
                        motivation_level: 5
                    },
                    measurements: {},
                    tests: {},
                    photos: {}
                },
                
                init() {
                    // Load saved progress if any
                    this.loadProgress();
                    this.updateProgress();
                },
                
                nextSection() {
                    if (this.currentSection < this.totalSections - 1) {
                        this.currentSection++;
                        this.updateProgress();
                        this.autoSave();
                        window.scrollTo(0, 0);
                    }
                },
                
                previousSection() {
                    if (this.currentSection > 0) {
                        this.currentSection--;
                        this.updateProgress();
                        window.scrollTo(0, 0);
                    }
                },
                
                updateProgress() {
                    this.progress = ((this.currentSection + 1) / this.totalSections) * 100;
                },
                
                autoSave() {
                    // Save to localStorage
                    localStorage.setItem('assessment_progress', JSON.stringify({
                        section: this.currentSection,
                        data: this.formData
                    }));
                    
                    // Also save to backend periodically
                    if (this.currentSection % 2 === 0) {
                        this.saveToBackend();
                    }
                },
                
                saveProgress() {
                    this.saveToBackend();
                    this.showNotification('Progress saved! You can continue anytime.', 'success');
                },
                
                saveToBackend() {
                    fetch('/api/assessment/save-progress', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            token: '{{ access_token }}',
                            data: this.formData,
                            section: this.currentSection
                        })
                    }).catch(error => {
                        console.error('Error saving progress:', error);
                    });
                },
                
                loadProgress() {
                    const saved = localStorage.getItem('assessment_progress');
                    if (saved) {
                        try {
                            const data = JSON.parse(saved);
                            this.formData = data.data;
                            this.currentSection = data.section;
                        } catch (e) {
                            console.error('Error loading saved progress:', e);
                        }
                    }
                },
                
                uploadPhoto(event, type) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    // Check file size (limit to 10MB)
                    if (file.size > 10 * 1024 * 1024) {
                        this.showNotification('Photo is too large. Please choose a photo under 10MB.', 'error');
                        return;
                    }
                    
                    // Show loading state
                    this.photoLoading[type] = true;
                    
                    // Initialize photo object if not exists
                    if (!this.formData.photos[type]) {
                        this.formData.photos[type] = {};
                    }
                    
                    // Create preview immediately for better UX
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.formData.photos[type].preview = e.target.result;
                    };
                    reader.readAsDataURL(file);
                    
                    // Compress and upload
                    this.compressAndUpload(file, type);
                },
                
                compressAndUpload(file, type) {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const img = new Image();
                    
                    img.onload = () => {
                        // Calculate new dimensions (max 1200px wide/tall)
                        let width = img.width;
                        let height = img.height;
                        const maxSize = 1200;
                        
                        if (width > height) {
                            if (width > maxSize) {
                                height = (height * maxSize) / width;
                                width = maxSize;
                            }
                        } else {
                            if (height > maxSize) {
                                width = (width * maxSize) / height;
                                height = maxSize;
                            }
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // Convert to blob
                        canvas.toBlob((blob) => {
                            const formData = new FormData();
                            formData.append('photo', blob, `${type}_photo.jpg`);
                            formData.append('type', type);
                            formData.append('token', '{{ access_token }}');
                            
                            fetch('/api/assessment/upload-photo', {
                                method: 'POST',
                                body: formData
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    this.formData.photos[type].uploaded = true;
                                    this.formData.photos[type].url = data.url;
                                    this.photoLoading[type] = false;
                                    this.showNotification('Photo uploaded successfully!', 'success');
                                } else {
                                    throw new Error(data.error || 'Upload failed');
                                }
                            })
                            .catch(error => {
                                this.showNotification('Failed to upload photo. Please try again.', 'error');
                                this.photoLoading[type] = false;
                                delete this.formData.photos[type];
                            });
                        }, 'image/jpeg', 0.8);
                    };
                    
                    img.src = URL.createObjectURL(file);
                },
                
                showNotification(message, type = 'info') {
                    // Haptic feedback on mobile (if supported)
                    if (navigator.vibrate && type === 'success') {
                        navigator.vibrate(200);
                    }
                    
                    // Create notification element
                    const notification = document.createElement('div');
                    const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
                    notification.className = `fixed top-4 right-4 ${bgColor} text-white px-4 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300`;
                    notification.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation' : 'info'}-circle mr-2"></i>
                            <span>${message}</span>
                        </div>
                    `;
                    
                    document.body.appendChild(notification);
                    
                    // Animate in
                    setTimeout(() => {
                        notification.style.transform = 'translateX(0)';
                    }, 10);
                    
                    // Remove after 3 seconds
                    setTimeout(() => {
                        notification.style.transform = 'translateX(400px)';
                        setTimeout(() => notification.remove(), 300);
                    }, 3000);
                },
                
                submitAssessment() {
                    if (this.isSubmitting) return;
                    
                    if (confirm('Are you ready to submit your assessment?')) {
                        this.isSubmitting = true;
                        
                        fetch('/api/assessment/submit', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                token: '{{ access_token }}',
                                data: this.formData
                            })
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                // Clear saved progress
                                localStorage.removeItem('assessment_progress');
                                
                                // Move to success screen
                                this.currentSection = 8;
                                this.updateProgress();
                                window.scrollTo(0, 0);
                                
                                // Show success notification
                                this.showNotification('Assessment submitted successfully!', 'success');
                            } else {
                                throw new Error(data.error || 'Submission failed');
                            }
                        })
                        .catch(error => {
                            this.showNotification('Failed to submit assessment. Please try again.', 'error');
                            this.isSubmitting = false;
                        });
                    }
                }
            }
        }
    </script>
</body>
</html>
