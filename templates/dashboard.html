<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ trainer.name }} - Dashboard | Refiloe</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js for interactivity -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Brand Colors */
        :root {
            --beige-light: #FFF8E8;
            --beige: #F7EED3;
            --sage: #AAB396;
            --brown: #674636;
            --sage-light: #C5D4B5;
            --sage-dark: #8B9578;
            --brown-light: #8B6F5F;
        }
        
        /* Custom styles for mobile-first design */
        body {
            background-color: var(--beige-light);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }
        
        /* Stats cards with brand gradients */
        .stats-card-1 {
            background: linear-gradient(135deg, var(--sage) 0%, var(--sage-dark) 100%);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .stats-card-2 {
            background: linear-gradient(135deg, var(--brown) 0%, var(--brown-light) 100%);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .stats-card-3 {
            background: linear-gradient(135deg, var(--sage-dark) 0%, var(--sage) 100%);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .stats-card-4 {
            background: linear-gradient(135deg, var(--brown-light) 0%, var(--brown) 100%);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        /* Hover effects for stats cards */
        .stats-card-1:hover, .stats-card-2:hover, 
        .stats-card-3:hover, .stats-card-4:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(103, 70, 54, 0.2);
        }
        
        /* Active tab styling */
        .active-tab {
            border-bottom: 3px solid var(--sage-dark);
            color: var(--brown);
        }
        
        /* Button styling */
        .btn-primary {
            background-color: var(--sage);
            color: white;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background-color: var(--sage-dark);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: var(--beige);
            color: var(--brown);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background-color: var(--beige-light);
            transform: translateY(-2px);
        }
        
        /* Header gradient */
        .header-gradient {
            background: linear-gradient(135deg, var(--beige) 0%, var(--sage-light) 100%);
        }
        
        /* Card backgrounds */
        .card-bg {
            background-color: var(--beige-light);
            border: 1px solid var(--beige);
        }
        
        /* Bottom nav styling */
        .bottom-nav {
            background-color: var(--beige);
            border-top: 1px solid var(--sage-light);
        }
        
        .nav-icon-active {
            color: var(--brown);
        }
        
        .nav-icon-inactive {
            color: var(--sage-dark);
        }
        
        @media (max-width: 640px) {
            .calendar-grid {
                font-size: 0.75rem;
            }
        }
        
        /* Smooth transitions */
        [x-cloak] { display: none !important; }
    </style>
</head>
<body>
    <div x-data="dashboardApp()" x-cloak class="min-h-screen pb-20">
        
        <!-- Header -->
        <header class="header-gradient shadow-sm sticky top-0 z-40">
            <div class="px-4 py-3">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-xl font-bold" style="color: var(--brown)">Hi {{ trainer.name }}! 👋</h1>
                        <p class="text-sm" style="color: var(--brown-light)">{{ current_date }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs" style="color: var(--brown-light)">Powered by</p>
                        <p class="text-sm font-semibold" style="color: var(--sage-dark)">Refiloe AI</p>
                    </div>
                </div>
            </div>
        </header>

        <!-- Stats Cards (Clickable) -->
        <div class="px-4 py-4">
            <div class="grid grid-cols-2 gap-3">
                <!-- Week Sessions - Click to go to Week view -->
                <div @click="activeTab = 'week'" class="stats-card-1 text-white p-4 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs opacity-90">This Week</p>
                            <p class="text-2xl font-bold">{{ stats.weekly_sessions }}</p>
                            <p class="text-xs opacity-75">sessions</p>
                        </div>
                        <i class="fas fa-calendar-check text-2xl opacity-50"></i>
                    </div>
                </div>
                
                <!-- Revenue - Click to go to Revenue tab -->
                <div @click="activeTab = 'revenue'" class="stats-card-2 text-white p-4 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs opacity-90">Revenue</p>
                            <p class="text-2xl font-bold">R{{ stats.monthly_revenue }}</p>
                            <p class="text-xs opacity-75">this month</p>
                        </div>
                        <i class="fas fa-coins text-2xl opacity-50"></i>
                    </div>
                </div>
                
                <!-- Clients - Click to go to Clients tab -->
                <div @click="activeTab = 'clients'" class="stats-card-3 text-white p-4 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs opacity-90">Active</p>
                            <p class="text-2xl font-bold">{{ stats.active_clients }}</p>
                            <p class="text-xs opacity-75">clients</p>
                        </div>
                        <i class="fas fa-users text-2xl opacity-50"></i>
                    </div>
                </div>
                
                <!-- Today - Click to go to Today tab -->
                <div @click="activeTab = 'today'" class="stats-card-4 text-white p-4 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs opacity-90">Today</p>
                            <p class="text-2xl font-bold">{{ stats.today_sessions }}</p>
                            <p class="text-xs opacity-75">sessions</p>
                        </div>
                        <i class="fas fa-fire text-2xl opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="px-4 py-2 sticky top-14 z-30 shadow-sm" style="background-color: var(--beige-light)">
            <div class="flex space-x-6 overflow-x-auto">
                <button @click="activeTab = 'today'" 
                        :class="activeTab === 'today' ? 'active-tab' : ''"
                        class="pb-2 px-1 text-sm font-medium whitespace-nowrap transition-all"
                        :style="activeTab === 'today' ? 'color: var(--brown)' : 'color: var(--sage-dark)'">
                    Today
                </button>
                <button @click="activeTab = 'week'" 
                        :class="activeTab === 'week' ? 'active-tab' : ''"
                        class="pb-2 px-1 text-sm font-medium whitespace-nowrap transition-all"
                        :style="activeTab === 'week' ? 'color: var(--brown)' : 'color: var(--sage-dark)'">
                    This Week
                </button>
                <button @click="activeTab = 'clients'" 
                        :class="activeTab === 'clients' ? 'active-tab' : ''"
                        class="pb-2 px-1 text-sm font-medium whitespace-nowrap transition-all"
                        :style="activeTab === 'clients' ? 'color: var(--brown)' : 'color: var(--sage-dark)'">
                    Clients
                </button>
                <button @click="activeTab = 'revenue'" 
                        :class="activeTab === 'revenue' ? 'active-tab' : ''"
                        class="pb-2 px-1 text-sm font-medium whitespace-nowrap transition-all"
                        :style="activeTab === 'revenue' ? 'color: var(--brown)' : 'color: var(--sage-dark)'">
                    Revenue
                </button>
                <button @click="activeTab = 'settings'" 
                        :class="activeTab === 'settings' ? 'active-tab' : ''"
                        class="pb-2 px-1 text-sm font-medium whitespace-nowrap transition-all"
                        :style="activeTab === 'settings' ? 'color: var(--brown)' : 'color: var(--sage-dark)'">
                    Settings
                </button>
            </div>
        </div>

        <!-- Tab Content -->
        <div class="px-4 py-4">
            
            <!-- Today Tab -->
            <div x-show="activeTab === 'today'" x-transition>
                <h2 class="text-lg font-semibold mb-3" style="color: var(--brown)">Today's Schedule</h2>
                
                {% if today_sessions %}
                    <div class="space-y-3">
                        {% for session in today_sessions %}
                        <div class="card-bg rounded-lg p-4 shadow-sm" style="border-left: 4px solid var(--sage)">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="font-semibold" style="color: var(--brown)">{{ session.client_name }}</p>
                                    <p class="text-sm" style="color: var(--brown-light)">
                                        <i class="far fa-clock mr-1"></i>
                                        {{ session.time }}
                                    </p>
                                    <p class="text-xs mt-1" style="color: var(--sage-dark)">
                                        {{ session.duration }} minutes • R{{ session.price }}
                                    </p>
                                </div>
                                <span class="px-2 py-1 text-xs rounded-full 
                                    {% if session.status == 'confirmed' %}
                                        bg-green-100 text-green-800
                                    {% else %}
                                        bg-yellow-100 text-yellow-800
                                    {% endif %}">
                                    {{ session.status }}
                                </span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="card-bg rounded-lg p-8 text-center">
                        <i class="fas fa-coffee text-4xl mb-3" style="color: var(--sage-light)"></i>
                        <p style="color: var(--brown)">No sessions scheduled for today</p>
                        <p class="text-sm mt-1" style="color: var(--brown-light)">Enjoy your free time! 🎉</p>
                    </div>
                {% endif %}
            </div>

            <!-- Week Tab -->
            <div x-show="activeTab === 'week'" x-transition>
                <h2 class="text-lg font-semibold mb-3" style="color: var(--brown)">This Week</h2>
                
                <div class="card-bg rounded-lg p-3">
                    <!-- Week Calendar Grid -->
                    <div class="calendar-grid mb-2">
                        <div class="text-center font-semibold text-xs py-2" style="color: var(--brown)">Mon</div>
                        <div class="text-center font-semibold text-xs py-2" style="color: var(--brown)">Tue</div>
                        <div class="text-center font-semibold text-xs py-2" style="color: var(--brown)">Wed</div>
                        <div class="text-center font-semibold text-xs py-2" style="color: var(--brown)">Thu</div>
                        <div class="text-center font-semibold text-xs py-2" style="color: var(--brown)">Fri</div>
                        <div class="text-center font-semibold text-xs py-2" style="color: var(--brown)">Sat</div>
                        <div class="text-center font-semibold text-xs py-2" style="color: var(--brown)">Sun</div>
                        
                        {% for day in week_days %}
                        <div class="text-center p-2 rounded" 
                            style="{% if day.is_today %}background-color: var(--sage-light);{% endif %}
                                   {% if day.has_sessions %}border: 1px solid var(--sage);{% endif %}">
                            <p class="text-sm font-medium" style="color: var(--brown)">{{ day.date }}</p>
                            {% if day.session_count > 0 %}
                                <p class="text-xs font-semibold" style="color: var(--sage-dark)">{{ day.session_count }}</p>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Week Sessions List -->
                    <div class="mt-4 space-y-2">
                        {% for session in week_sessions %}
                        <div class="pl-3 py-2" style="border-left: 2px solid var(--sage-light)">
                            <p class="text-sm font-medium" style="color: var(--brown)">{{ session.day }} - {{ session.client_name }}</p>
                            <p class="text-xs" style="color: var(--brown-light)">{{ session.time }} • {{ session.duration }}min</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Clients Tab -->
            <div x-show="activeTab === 'clients'" x-transition>
                <h2 class="text-lg font-semibold mb-3" style="color: var(--brown)">Your Clients ({{ clients|length }})</h2>
                
                <div class="space-y-3">
                    {% for client in clients %}
                    <div class="card-bg rounded-lg p-4 shadow-sm">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <p class="font-semibold" style="color: var(--brown)">{{ client.name }}</p>
                                <p class="text-sm" style="color: var(--brown-light)">
                                    <i class="fas fa-box mr-1"></i>
                                    {{ client.package_type }} • {{ client.sessions_remaining }} sessions left
                                </p>
                                <p class="text-xs mt-1" style="color: var(--sage-dark)">
                                    Last session: {{ client.last_session_display }}
                                </p>
                            </div>
                            <button class="text-sm" style="color: var(--sage-dark)"
                                    onclick="sendWhatsApp('{{ client.whatsapp }}')">
                                <i class="fab fa-whatsapp text-xl"></i>
                            </button>
                        </div>
                        
                        {% if client.sessions_remaining <= 2 %}
                        <div class="mt-2 p-2 rounded text-xs" style="background-color: var(--beige); color: var(--brown)">
                            ⚠️ Package almost finished
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Revenue Tab -->
            <div x-show="activeTab === 'revenue'" x-transition>
                <h2 class="text-lg font-semibold mb-3" style="color: var(--brown)">Revenue Overview</h2>
                
                <div class="card-bg rounded-lg p-4">
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm" style="color: var(--brown-light)">This Month</span>
                                <span class="text-sm font-bold" style="color: var(--brown)">R{{ revenue.this_month }}</span>
                            </div>
                            <div class="w-full rounded-full h-2" style="background-color: var(--beige)">
                                <div class="h-2 rounded-full" style="background-color: var(--sage); width: {{ revenue.month_progress }}%"></div>
                            </div>
                        </div>
                        
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm" style="color: var(--brown-light)">Last Month</span>
                                <span class="text-sm" style="color: var(--brown)">R{{ revenue.last_month }}</span>
                            </div>
                        </div>
                        
                        <div class="pt-3" style="border-top: 1px solid var(--beige)">
                            <div class="flex justify-between">
                                <span class="text-sm" style="color: var(--brown-light)">Outstanding</span>
                                <span class="text-sm font-bold" style="color: var(--brown)">R{{ revenue.outstanding }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Payments -->
                <h3 class="text-md font-semibold mt-4 mb-2" style="color: var(--brown)">Recent Payments</h3>
                <div class="space-y-2">
                    {% for payment in recent_payments %}
                    <div class="card-bg rounded p-3 flex justify-between items-center">
                        <div>
                            <p class="text-sm font-medium" style="color: var(--brown)">{{ payment.client_name }}</p>
                            <p class="text-xs" style="color: var(--brown-light)">{{ payment.date }}</p>
                        </div>
                        <span class="font-semibold" style="color: var(--sage-dark)">R{{ payment.amount }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Settings Tab -->
            <div x-show="activeTab === 'settings'" x-transition>
                <h2 class="text-lg font-semibold mb-3" style="color: var(--brown)">Settings</h2>
                
                <div class="space-y-4">
                    <!-- Availability -->
                    <div class="card-bg rounded-lg p-4">
                        <h3 class="font-medium mb-3" style="color: var(--brown)">Your Availability</h3>
                        <div class="space-y-2 text-sm">
                            {% for day, slots in availability.items() %}
                            <div class="flex justify-between">
                                <span style="color: var(--brown-light)">{{ day|capitalize }}</span>
                                <span style="color: var(--brown)">
                                    {% if slots %}
                                        {{ slots|join(', ') }}
                                    {% else %}
                                        Closed
                                    {% endif %}
                                </span>
                            </div>
                            {% endfor %}
                        </div>
                        <button onclick="updateAvailability()" 
                                class="mt-3 w-full btn-primary py-2 rounded text-sm font-medium">
                            Update via WhatsApp
                        </button>
                    </div>
                    
                    <!-- Session Settings -->
                    <div class="card-bg rounded-lg p-4">
                        <h3 class="font-medium mb-3" style="color: var(--brown)">Session Settings</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span style="color: var(--brown-light)">Default Duration</span>
                                <span style="color: var(--brown)">{{ settings.session_duration }} minutes</span>
                            </div>
                            <div class="flex justify-between">
                                <span style="color: var(--brown-light)">Price per Session</span>
                                <span style="color: var(--brown)">R{{ settings.price_per_session }}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="card-bg rounded-lg p-4">
                        <h3 class="font-medium mb-3" style="color: var(--brown)">Quick Actions</h3>
                        <div class="space-y-2">
                            <button onclick="sendReminders()" 
                                    class="w-full btn-primary py-2 rounded text-sm font-medium">
                                Send Client Reminders
                            </button>
                            <button onclick="exportData()" 
                                    class="w-full btn-secondary py-2 rounded text-sm font-medium">
                                Export This Month's Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation (Mobile) -->
        <div class="fixed bottom-0 left-0 right-0 bottom-nav md:hidden">
            <div class="grid grid-cols-4 py-2">
                <button @click="activeTab = 'today'" class="flex flex-col items-center py-2">
                    <i class="fas fa-calendar-day text-xl" 
                       :class="activeTab === 'today' ? 'nav-icon-active' : 'nav-icon-inactive'"></i>
                    <span class="text-xs mt-1" 
                          :class="activeTab === 'today' ? 'nav-icon-active' : 'nav-icon-inactive'">Today</span>
                </button>
                <button @click="activeTab = 'week'" class="flex flex-col items-center py-2">
                    <i class="fas fa-calendar-week text-xl" 
                       :class="activeTab === 'week' ? 'nav-icon-active' : 'nav-icon-inactive'"></i>
                    <span class="text-xs mt-1" 
                          :class="activeTab === 'week' ? 'nav-icon-active' : 'nav-icon-inactive'">Week</span>
                </button>
                <button @click="activeTab = 'clients'" class="flex flex-col items-center py-2">
                    <i class="fas fa-users text-xl" 
                       :class="activeTab === 'clients' ? 'nav-icon-active' : 'nav-icon-inactive'"></i>
                    <span class="text-xs mt-1" 
                          :class="activeTab === 'clients' ? 'nav-icon-active' : 'nav-icon-inactive'">Clients</span>
                </button>
                <button @click="activeTab = 'revenue'" class="flex flex-col items-center py-2">
                    <i class="fas fa-chart-line text-xl" 
                       :class="activeTab === 'revenue' ? 'nav-icon-active' : 'nav-icon-inactive'"></i>
                    <span class="text-xs mt-1" 
                          :class="activeTab === 'revenue' ? 'nav-icon-active' : 'nav-icon-inactive'">Revenue</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Alpine.js app for interactivity
        function dashboardApp() {
            return {
                activeTab: 'today',
                init() {
                    // Check if there's a hash in URL for specific tab
                    if (window.location.hash) {
                        const tab = window.location.hash.substring(1);
                        if (['today', 'week', 'clients', 'revenue', 'settings'].includes(tab)) {
                            this.activeTab = tab;
                        }
                    }
                }
            }
        }
        
        // Helper functions
        function sendWhatsApp(number) {
            window.open(`https://wa.me/${number}`, '_blank');
        }
        
        function updateAvailability() {
            window.open(`https://wa.me/YOUR_BOT_NUMBER?text=Update my availability`, '_blank');
        }
        
        function sendReminders() {
            if (confirm('Send reminders to all clients with low sessions?')) {
                window.open(`https://wa.me/YOUR_BOT_NUMBER?text=Send reminders to my clients`, '_blank');
            }
        }
        
        function exportData() {
            // This will trigger download from the Flask backend
            window.location.href = `/export/${window.location.pathname.split('/').pop()}`;
        }
    </script>
</body>
</html>
